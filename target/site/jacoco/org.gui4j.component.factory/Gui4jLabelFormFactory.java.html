<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gui4jLabelFormFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.component.factory</a> &gt; <span class="el_source">Gui4jLabelFormFactory.java</span></div><h1>Gui4jLabelFormFactory.java</h1><pre class="source lang-java linenums">package org.gui4j.component.factory;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import org.dom4j.LElement;
import org.gui4j.component.Gui4jJComponent;
import org.gui4j.component.Gui4jLabelForm;
import org.gui4j.core.Gui4jComponentContainer;
import org.gui4j.core.Gui4jComponentContainerManager;
import org.gui4j.core.Gui4jQualifiedComponent;
import org.gui4j.core.definition.Attribute;
import org.gui4j.core.definition.AttributeTypeInteger;
import org.gui4j.core.definition.AttributeTypeString;
import org.gui4j.exception.Gui4jUncheckedException;
import org.gui4j.util.Filter;

<span class="nc" id="L18">public class Gui4jLabelFormFactory extends Gui4jJComponentFactory {</span>

  private static final String NAME = &quot;labelForm&quot;;
  private static final String HSPACING = &quot;hSpacing&quot;;
  private static final String VSPACING = &quot;vSpacing&quot;;
  private static final String COLUMNS = &quot;columns&quot;;
  private static final String COMPONENTWIDTHS = &quot;componentWidths&quot;;
  private static final String COMPONENTWIDTH = &quot;componentWidth&quot;;
  private static final String COLSPACING = &quot;colSpacing&quot;;
  private static final String COLSPANS = &quot;colSpans&quot;;
  private static final String COLUMN = &quot;labelColumn&quot;;
  private static final String LABELS = &quot;labels&quot;;
  private static final String COMPONENTS = &quot;components&quot;;
  private static final String MARKERS = &quot;markers&quot;;

  protected Gui4jJComponent defineGui4jJComponentBy(
      Gui4jComponentContainer gui4jComponentContainer, String id, LElement e) {
<span class="nc" id="L35">    Gui4jLabelForm gui4jLabelForm = new Gui4jLabelForm(gui4jComponentContainer, id);</span>

<span class="nc" id="L37">    gui4jLabelForm.setHspCall(getGui4jAccessInstance(Integer.TYPE, gui4jLabelForm, e, HSPACING));</span>
<span class="nc" id="L38">    gui4jLabelForm.setVspCall(getGui4jAccessInstance(Integer.TYPE, gui4jLabelForm, e, VSPACING));</span>
<span class="nc" id="L39">    gui4jLabelForm.setColSpacing(getIntValue(gui4jComponentContainer, e, COLSPACING, 10));</span>
<span class="nc" id="L40">    gui4jLabelForm.setComponentWidths(e.attributeValue(COMPONENTWIDTHS));</span>

<span class="nc" id="L42">    int numColumns = getIntValue(gui4jComponentContainer, e, COLUMNS, 1);</span>
<span class="nc" id="L43">    gui4jLabelForm.setNumColumns(numColumns);</span>

    {
<span class="nc" id="L46">      List children = e.elements();</span>
<span class="nc bnc" id="L47" title="All 2 branches missed.">      if (children.isEmpty()) {</span>
<span class="nc" id="L48">        return gui4jLabelForm;</span>
      }

<span class="nc" id="L51">      LElement firstChild = (LElement) children.get(0);</span>
<span class="nc bnc" id="L52" title="All 2 branches missed.">      if (firstChild.getName().equals(COLUMN)) {</span>
        // loop over all column tags and extract label/component tags for each one
<span class="nc bnc" id="L54" title="All 2 branches missed.">        for (Iterator iter = children.iterator(); iter.hasNext(); ) {</span>
<span class="nc" id="L55">          LElement columnTag = (LElement) iter.next();</span>
<span class="nc" id="L56">          Gui4jLabelForm.Column column = new Gui4jLabelForm.Column();</span>
<span class="nc" id="L57">          extractColumnContent(columnTag.elements(), column, gui4jComponentContainer);</span>
<span class="nc" id="L58">          column.setComponentWidth(columnTag.attributeValue(COMPONENTWIDTH));</span>
<span class="nc" id="L59">          column.setColSpans(columnTag.attributeValue(COLSPANS));</span>
<span class="nc" id="L60">          gui4jLabelForm.addColumn(column);</span>
<span class="nc" id="L61">        }</span>

      } else {
        // extract label/component tags for the default column
<span class="nc" id="L65">        Gui4jLabelForm.Column column = new Gui4jLabelForm.Column();</span>
<span class="nc" id="L66">        extractColumnContent(children, column, gui4jComponentContainer);</span>
<span class="nc" id="L67">        gui4jLabelForm.addColumn(column);</span>
      }
    }

<span class="nc" id="L71">    return gui4jLabelForm;</span>
  }

  private void extractColumnContent(
      List elements,
      Gui4jLabelForm.Column column,
      Gui4jComponentContainer gui4jComponentContainer) {
<span class="nc" id="L78">    List errorList = new ArrayList();</span>
<span class="nc bnc" id="L79" title="All 2 branches missed.">    for (Iterator iter = elements.iterator(); iter.hasNext(); ) {</span>
      try {
<span class="nc" id="L81">        LElement element = (LElement) iter.next();</span>

<span class="nc bnc" id="L83" title="All 2 branches missed.">        if (element.getName().equals(COLUMN)) {</span>
<span class="nc" id="L84">          throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L85">              gui4jComponentContainer.getConfigurationName(),</span>
<span class="nc" id="L86">              Gui4jComponentContainerManager.getLineNumber(element),</span>
              RESOURCE_ERROR_labelform_column_conflict);
        }

<span class="nc bnc" id="L90" title="All 2 branches missed.">        for (Iterator it = element.elements().iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L91">          LElement child = (LElement) it.next();</span>
<span class="nc" id="L92">          gui4jComponentContainer.autoExtend(child);</span>
<span class="nc" id="L93">          Gui4jQualifiedComponent childComponent =</span>
<span class="nc" id="L94">              gui4jComponentContainer.extractGui4jComponent(child);</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">          if (element.getName().equals(LABELS)) {</span>
<span class="nc" id="L96">            column.addLabel(childComponent);</span>
<span class="nc bnc" id="L97" title="All 2 branches missed.">          } else if (element.getName().equals(COMPONENTS)) {</span>
<span class="nc" id="L98">            column.addComponent(childComponent);</span>
<span class="nc bnc" id="L99" title="All 2 branches missed.">          } else if (element.getName().equals(MARKERS)) {</span>
<span class="nc" id="L100">            column.addMarker(childComponent);</span>
          } else {
<span class="nc" id="L102">            throw new RuntimeException(&quot;Unexpected subelement.&quot;);</span>
          }
<span class="nc" id="L104">        }</span>
<span class="nc" id="L105">      } catch (Throwable t) {</span>
<span class="nc" id="L106">        errorList.add(t);</span>
<span class="nc" id="L107">      }</span>
    }
<span class="nc" id="L109">    checkErrorList(errorList);</span>
<span class="nc" id="L110">  }</span>

  public void addInnerAttributes(String elementName, List list) {
<span class="nc bnc" id="L113" title="All 2 branches missed.">    if (COLUMN.equals(elementName)) {</span>
<span class="nc" id="L114">      list.add(new Attribute(COMPONENTWIDTH, new AttributeTypeString(), IMPLIED, false));</span>
<span class="nc" id="L115">      list.add(new Attribute(COLSPANS, new AttributeTypeString(), IMPLIED, false));</span>
    }
<span class="nc" id="L117">  }</span>

  public SubElement getSubElement(String elementName) {
<span class="nc bnc" id="L120" title="All 2 branches missed.">    if (MARKERS.equals(elementName)</span>
<span class="nc bnc" id="L121" title="All 2 branches missed.">        || LABELS.equals(elementName)</span>
<span class="nc bnc" id="L122" title="All 2 branches missed.">        || COMPONENTS.equals(elementName)) {</span>
<span class="nc" id="L123">      return SubElement.star(SubElement.gui4jComponent());</span>
    }
<span class="nc bnc" id="L125" title="All 2 branches missed.">    if (NAME.equals(elementName)) {</span>
<span class="nc" id="L126">      SubElement columns = SubElement.plus(SubElement.getInstance(COLUMN));</span>
<span class="nc" id="L127">      SubElement content = getSubElementColumnContent();</span>
<span class="nc" id="L128">      return SubElement.or(new SubElement[] {columns, content});</span>
    }
<span class="nc bnc" id="L130" title="All 2 branches missed.">    if (COLUMN.equals(elementName)) {</span>
<span class="nc" id="L131">      return getSubElementColumnContent();</span>
    }
<span class="nc" id="L133">    return null;</span>
  }

  private SubElement getSubElementColumnContent() {
<span class="nc" id="L137">    SubElement[] mandatorySubElements =</span>
<span class="nc" id="L138">        new SubElement[] {SubElement.getInstance(LABELS), SubElement.getInstance(COMPONENTS)};</span>
<span class="nc" id="L139">    SubElement[] allSubElements =</span>
        new SubElement[] {
<span class="nc" id="L141">          SubElement.optional(SubElement.getInstance(MARKERS)), SubElement.seq(mandatorySubElements)</span>
        };
<span class="nc" id="L143">    return SubElement.seq(allSubElements);</span>
  }

  public String getName() {
<span class="nc" id="L147">    return NAME;</span>
  }

  public void addToplevelAttributes(List attrList, Filter filter) {
<span class="nc" id="L151">    super.addToplevelAttributes(attrList, filter);</span>
<span class="nc bnc" id="L152" title="All 4 branches missed.">    if (filter == null || filter.takeIt(Gui4jLabelFormFactory.class)) {</span>
<span class="nc" id="L153">      attrList.add(new Attribute(HSPACING, new AttributeTypeInteger(), IMPLIED, false));</span>
<span class="nc" id="L154">      attrList.add(new Attribute(VSPACING, new AttributeTypeInteger(), IMPLIED, false));</span>
<span class="nc" id="L155">      attrList.add(new Attribute(COLSPACING, new AttributeTypeInteger(), IMPLIED, false));</span>
<span class="nc" id="L156">      attrList.add(new Attribute(COLUMNS, new AttributeTypeInteger(), IMPLIED, false));</span>
<span class="nc" id="L157">      attrList.add(new Attribute(COMPONENTWIDTHS, new AttributeTypeString(), IMPLIED, false));</span>
    }
<span class="nc" id="L159">  }</span>

  public String[] getInnerElements() {
<span class="nc" id="L162">    String[] elems = {MARKERS, LABELS, COMPONENTS, COLUMN};</span>
<span class="nc" id="L163">    return elems;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>