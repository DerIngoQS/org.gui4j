<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gui4jTreeFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.component.factory</a> &gt; <span class="el_source">Gui4jTreeFactory.java</span></div><h1>Gui4jTreeFactory.java</h1><pre class="source lang-java linenums">package org.gui4j.component.factory;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.Collection;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import javax.swing.Icon;
import org.dom4j.LElement;
import org.gui4j.component.Gui4jJComponent;
import org.gui4j.component.Gui4jTree;
import org.gui4j.core.Gui4jCall;
import org.gui4j.core.Gui4jComponentContainer;
import org.gui4j.core.Gui4jComponentContainerManager;
import org.gui4j.core.Gui4jMap1;
import org.gui4j.core.definition.Attribute;
import org.gui4j.core.definition.AttributeTypeAlias;
import org.gui4j.core.definition.AttributeTypeEnumeration;
import org.gui4j.core.definition.AttributeTypeMethodCall;
import org.gui4j.core.definition.Param;
import org.gui4j.exception.Gui4jUncheckedException;
import org.gui4j.util.Filter;

<span class="nc" id="L27">public final class Gui4jTreeFactory extends Gui4jJComponentFactory {</span>

  private static final String NAME = &quot;tree&quot;;
  private static final String ROOT = &quot;root&quot;;
  private static final String NODE = &quot;node&quot;;
  private static final String CONTENTTYPE = &quot;contentType&quot;;
  private static final String VALUE = &quot;value&quot;;
  private static final String CHILDREN = &quot;children&quot;;
  private static final String ONSELECT = &quot;onSelect&quot;;
  private static final String ONDBLCLICK = &quot;onDblClick&quot;;
  private static final String SELECTEDNODE = &quot;selectedNode&quot;;
  private static final String SELECTEDPATH = &quot;selectedPath&quot;;
  private static final String REFRESH = &quot;refresh&quot;;
  private static final String RELOAD = &quot;reload&quot;;
  private static final String LAZY = &quot;lazy&quot;;
  private static final String LAZYMESSAGE = &quot;lazyMessage&quot;;
  private static final String ISLEAF = &quot;isLeaf&quot;;
  private static final String HIDE_ROOT_NODE = &quot;hideRootNode&quot;;
  private static final String ICON = &quot;icon&quot;;
  private static final String ICONPOSITION = &quot;iconPosition&quot;;
  private static final String USEORIGINALCOLLECTION = &quot;useOriginalCollection&quot;;
  private static final String INITIALLYEXPAND = &quot;initiallyExpand&quot;;

  protected Gui4jJComponent defineGui4jJComponentBy(
      Gui4jComponentContainer gui4jComponentContainer, String id, LElement e) {
<span class="nc" id="L52">    String configurationName = gui4jComponentContainer.getConfigurationName();</span>

<span class="nc" id="L54">    boolean lazy = gui4jComponentContainer.getBooleanAttrValue(e, LAZY, false);</span>

<span class="nc" id="L56">    boolean hideRootNode = gui4jComponentContainer.getBooleanAttrValue(e, HIDE_ROOT_NODE, false);</span>
<span class="nc" id="L57">    boolean useOriginalCollection =</span>
<span class="nc" id="L58">        gui4jComponentContainer.getBooleanAttrValue(e, USEORIGINALCOLLECTION, false);</span>
<span class="nc" id="L59">    boolean initiallyExpand =</span>
<span class="nc" id="L60">        gui4jComponentContainer.getBooleanAttrValue(e, INITIALLYEXPAND, false);</span>
<span class="nc" id="L61">    Gui4jTree gui4jTree =</span>
        new Gui4jTree(
            gui4jComponentContainer,
            id,
            lazy,
            hideRootNode,
            useOriginalCollection,
            initiallyExpand);
<span class="nc" id="L69">    gui4jTree.definePropertySetter(ROOT, getGui4jAccessInstance(Object.class, gui4jTree, e, ROOT));</span>
<span class="nc" id="L70">    gui4jTree.definePropertySetter(</span>
<span class="nc" id="L71">        RELOAD, getGui4jAccessInstance(Object[].class, gui4jTree, e, RELOAD));</span>

<span class="nc" id="L73">    Gui4jCall lazyMessage = getGui4jAccessInstance(String.class, gui4jTree, e, LAZYMESSAGE);</span>
<span class="nc" id="L74">    gui4jTree.setLazyMessageCall(lazyMessage);</span>

<span class="nc" id="L76">    Gui4jCall selectedNode = getGui4jAccessInstance(Object.class, gui4jTree, e, SELECTEDNODE);</span>
<span class="nc" id="L77">    gui4jTree.definePropertySetter(SELECTEDNODE, selectedNode);</span>
<span class="nc" id="L78">    gui4jTree.setSelectedNodeCall(selectedNode);</span>

<span class="nc" id="L80">    Gui4jCall selectedPath = getGui4jAccessInstance(Object.class, gui4jTree, e, SELECTEDPATH);</span>
<span class="nc" id="L81">    gui4jTree.definePropertySetter(SELECTEDPATH, selectedPath);</span>
<span class="nc" id="L82">    gui4jTree.setSelectedPathCall(selectedPath);</span>

    {
<span class="nc" id="L85">      Map params = new Gui4jMap1(Gui4jTree.PARAM_PATH, Object[].class);</span>
<span class="nc" id="L86">      Gui4jCall onSelectCall = getGui4jAccessInstance(null, params, gui4jTree, e, ONSELECT);</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">      if (onSelectCall != null) {</span>
<span class="nc" id="L88">        gui4jTree.setOnSelectCallTree(onSelectCall);</span>
      }
    }

    {
<span class="nc" id="L93">      Map m = null;</span>
<span class="nc" id="L94">      Gui4jCall refresh = getGui4jAccessInstance(null, m, gui4jTree, e, REFRESH);</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">      if (refresh != null) {</span>
<span class="nc" id="L96">        Gui4jCall[] dependantProperties = refresh.getDependantProperties();</span>
<span class="nc bnc" id="L97" title="All 4 branches missed.">        if (dependantProperties == null || dependantProperties.length == 0) {</span>
          // mLogger.warn(&quot;Set of dependant events is empty&quot;);
        }
<span class="nc" id="L100">        gui4jTree.setRefreshEvents(dependantProperties);</span>
      }
    }

<span class="nc" id="L104">    List errorList = new ArrayList();</span>
<span class="nc" id="L105">    List children = e.elements();</span>
<span class="nc bnc" id="L106" title="All 2 branches missed.">    for (Iterator iter = children.iterator(); iter.hasNext(); ) {</span>
      try {
<span class="nc" id="L108">        LElement child = (LElement) iter.next();</span>

<span class="nc bnc" id="L110" title="All 2 branches missed.">        assert child.getName().equals(NODE);</span>

<span class="nc" id="L112">        String nodeContentAliasName = gui4jComponentContainer.getAttrValue(child, CONTENTTYPE);</span>
<span class="nc" id="L113">        Class nodeContentClazz = gui4jComponentContainer.getClassForAliasName(nodeContentAliasName);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">        if (nodeContentClazz == null) {</span>
<span class="nc" id="L115">          Object[] args = {nodeContentAliasName, nodeContentAliasName};</span>
<span class="nc" id="L116">          throw new Gui4jUncheckedException.ResourceError(</span>
              configurationName,
<span class="nc" id="L118">              Gui4jComponentContainerManager.getLineNumber(child.attribute(CONTENTTYPE)),</span>
              RESOURCE_ERROR_alias_not_defined_in_path,
              args);
        }

<span class="nc" id="L123">        Map paramTypes = new Gui4jMap1(Gui4jTree.PARAM_ITEM, nodeContentClazz);</span>
<span class="nc" id="L124">        Gui4jCall valueCall =</span>
<span class="nc" id="L125">            getGui4jAccessInstance(String.class, paramTypes, gui4jTree, child, VALUE);</span>
<span class="nc" id="L126">        Gui4jCall childrenCall =</span>
<span class="nc" id="L127">            getGui4jAccessInstance(List.class, paramTypes, gui4jTree, child, CHILDREN);</span>
<span class="nc" id="L128">        Gui4jCall isLeafCall =</span>
<span class="nc" id="L129">            getGui4jAccessInstance(Boolean.TYPE, paramTypes, gui4jTree, child, ISLEAF);</span>
<span class="nc" id="L130">        Gui4jCall onSelectCall =</span>
<span class="nc" id="L131">            getGui4jAccessInstance(null, paramTypes, gui4jTree, child, ONSELECT);</span>
<span class="nc" id="L132">        Gui4jCall onDblClickCall =</span>
<span class="nc" id="L133">            getGui4jAccessInstance(null, paramTypes, gui4jTree, child, ONDBLCLICK);</span>
<span class="nc" id="L134">        Gui4jCall iconCall = getGui4jAccessInstance(Icon.class, paramTypes, gui4jTree, child, ICON);</span>
<span class="nc" id="L135">        String iconPosition = child.attributeValue(ICONPOSITION, &quot;leading&quot;);</span>
<span class="nc" id="L136">        boolean lazyNode = gui4jComponentContainer.getBooleanAttrValue(child, LAZY, false);</span>
<span class="nc" id="L137">        gui4jTree.addNode(</span>
            nodeContentClazz,
            valueCall,
            childrenCall,
            onSelectCall,
            onDblClickCall,
            iconCall,
            isLeafCall,
            iconPosition,
            lazyNode);
<span class="nc" id="L147">      } catch (Throwable t) {</span>
<span class="nc" id="L148">        errorList.add(t);</span>
<span class="nc" id="L149">      }</span>
    }
<span class="nc" id="L151">    checkErrorList(errorList);</span>

<span class="nc" id="L153">    return gui4jTree;</span>
  }

  public String getName() {
<span class="nc" id="L157">    return NAME;</span>
  }

  public SubElement getSubElement(String elementName) {
<span class="nc bnc" id="L161" title="All 2 branches missed.">    if (NAME.equals(elementName)) {</span>
<span class="nc" id="L162">      return SubElement.star(SubElement.getInstance(NODE));</span>
    }
<span class="nc bnc" id="L164" title="All 2 branches missed.">    if (NODE.equals(elementName)) {</span>
<span class="nc" id="L165">      return SubElement.empty();</span>
    }
<span class="nc" id="L167">    return null;</span>
  }

  public void addInnerAttributes(String elementName, List list) {
<span class="nc bnc" id="L171" title="All 2 branches missed.">    if (NODE.equals(elementName)) {</span>
<span class="nc" id="L172">      Set setIconPosition = new HashSet();</span>
<span class="nc" id="L173">      setIconPosition.add(new Param(&quot;leading&quot;));</span>
<span class="nc" id="L174">      setIconPosition.add(new Param(&quot;trailing&quot;));</span>

<span class="nc" id="L176">      List itemParam = new ArrayList();</span>
<span class="nc" id="L177">      itemParam.add(new Param(Gui4jTree.PARAM_ITEM));</span>

<span class="nc" id="L179">      Attribute[] attrs = {</span>
        new Attribute(CONTENTTYPE, new AttributeTypeAlias(), REQUIRED, false),
        new Attribute(VALUE, new AttributeTypeMethodCall(String.class, itemParam), REQUIRED, false),
        new Attribute(
            CHILDREN, new AttributeTypeMethodCall(Collection.class, itemParam), IMPLIED, false),
        new Attribute(ISLEAF, new AttributeTypeMethodCall(Boolean.TYPE, itemParam), IMPLIED, false),
        new Attribute(ICON, new AttributeTypeMethodCall(Icon.class, itemParam), IMPLIED, false),
        new Attribute(ICONPOSITION, new AttributeTypeEnumeration(setIconPosition), IMPLIED, false),
<span class="nc" id="L187">        new Attribute(LAZY, AttributeTypeEnumeration.getBooleanInstance(false), IMPLIED, false),</span>
        new Attribute(ONSELECT, new AttributeTypeMethodCall(null, itemParam), IMPLIED, false),
        new Attribute(ONDBLCLICK, new AttributeTypeMethodCall(null, itemParam), IMPLIED, false)
      };
<span class="nc" id="L191">      list.addAll(Arrays.asList(attrs));</span>
    }
<span class="nc" id="L193">  }</span>

  public void addToplevelAttributes(List attrList, Filter filter) {
<span class="nc" id="L196">    super.addToplevelAttributes(attrList, filter);</span>
<span class="nc bnc" id="L197" title="All 4 branches missed.">    if (filter == null || filter.takeIt(Gui4jTreeFactory.class)) {</span>
<span class="nc" id="L198">      attrList.add(new Attribute(ROOT, new AttributeTypeMethodCall(Object.class), REQUIRED, false));</span>
<span class="nc" id="L199">      attrList.add(</span>
          new Attribute(SELECTEDNODE, new AttributeTypeMethodCall(Object.class), IMPLIED, false));
<span class="nc" id="L201">      attrList.add(</span>
          new Attribute(SELECTEDPATH, new AttributeTypeMethodCall(Object[].class), IMPLIED, false));
<span class="nc" id="L203">      attrList.add(new Attribute(REFRESH, new AttributeTypeMethodCall(null), IMPLIED, false));</span>
<span class="nc" id="L204">      attrList.add(</span>
          new Attribute(RELOAD, new AttributeTypeMethodCall(Object[].class), IMPLIED, false));
<span class="nc" id="L206">      attrList.add(</span>
<span class="nc" id="L207">          new Attribute(LAZY, AttributeTypeEnumeration.getBooleanInstance(false), IMPLIED, false));</span>
<span class="nc" id="L208">      attrList.add(</span>
          new Attribute(LAZYMESSAGE, new AttributeTypeMethodCall(String.class), IMPLIED, false));
<span class="nc" id="L210">      attrList.add(</span>
          new Attribute(
<span class="nc" id="L212">              HIDE_ROOT_NODE, AttributeTypeEnumeration.getBooleanInstance(false), IMPLIED, false));</span>
<span class="nc" id="L213">      attrList.add(</span>
          new Attribute(
              USEORIGINALCOLLECTION,
<span class="nc" id="L216">              AttributeTypeEnumeration.getBooleanInstance(false),</span>
              IMPLIED,
              false));
<span class="nc" id="L219">      attrList.add(</span>
          new Attribute(
<span class="nc" id="L221">              INITIALLYEXPAND, AttributeTypeEnumeration.getBooleanInstance(false), IMPLIED, false));</span>

      {
<span class="nc" id="L224">        List params = new ArrayList();</span>
<span class="nc" id="L225">        params.add(new Param(Gui4jTree.PARAM_PATH));</span>
<span class="nc" id="L226">        attrList.add(</span>
            new Attribute(ONSELECT, new AttributeTypeMethodCall(null, params), IMPLIED, false));
      }
    }
<span class="nc" id="L230">  }</span>

  public String[] getInnerElements() {
<span class="nc" id="L233">    String[] elems = {NODE};</span>
<span class="nc" id="L234">    return elems;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>