<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ComboBoxHorizontalScroll.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core.swing</a> &gt; <span class="el_source">ComboBoxHorizontalScroll.java</span></div><h1>ComboBoxHorizontalScroll.java</h1><pre class="source lang-java linenums">package org.gui4j.core.swing;

import java.awt.event.FocusEvent;
import java.lang.reflect.Field;
import javax.swing.CellEditor;
import javax.swing.ComboBoxModel;
import javax.swing.JComboBox;
import javax.swing.JScrollBar;
import javax.swing.JScrollPane;
import javax.swing.JWindow;
import javax.swing.plaf.ComboBoxUI;
import javax.swing.plaf.basic.BasicComboBoxUI;
import javax.swing.plaf.basic.BasicComboPopup;
import javax.swing.plaf.basic.ComboPopup;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.gui4j.core.listener.Gui4jActionListenerComboBox;

/** ComboBox which supports vertical and horizontal scrollbars. */
public class ComboBoxHorizontalScroll extends JComboBox {
<span class="nc" id="L21">  private static final Log log = LogFactory.getLog(ComboBoxHorizontalScroll.class);</span>

  private CellEditor cellEditor;
  private Gui4jActionListenerComboBox actionListener;

  /**
   * @param model
   */
  public ComboBoxHorizontalScroll(ComboBoxModel model) {
<span class="nc" id="L30">    super(model);</span>
<span class="nc" id="L31">  }</span>

  public ComboBoxHorizontalScroll() {
<span class="nc" id="L34">    super();</span>
<span class="nc" id="L35">  }</span>

  public void updateUI() {
<span class="nc" id="L38">    super.updateUI();</span>
<span class="nc" id="L39">    enableHorizontalScrollbar(getUI());</span>
<span class="nc" id="L40">  }</span>

  public CellEditor getCellEditor() {
<span class="nc" id="L43">    return cellEditor;</span>
  }

  protected void processFocusEvent(FocusEvent e) {
<span class="nc" id="L47">    super.processFocusEvent(e);</span>
<span class="nc bnc" id="L48" title="All 4 branches missed.">    if (e.getID() == FocusEvent.FOCUS_LOST</span>
        &amp;&amp; cellEditor != null
<span class="nc bnc" id="L50" title="All 2 branches missed.">        &amp;&amp; !(e.getOppositeComponent() instanceof JWindow)</span>
<span class="nc bnc" id="L51" title="All 2 branches missed.">        &amp;&amp; !(e.getOppositeComponent() instanceof JScrollBar)) {</span>
<span class="nc" id="L52">      cellEditor.stopCellEditing();</span>
    }
<span class="nc" id="L54">  }</span>

  public void setCellEditor(CellEditor cellEditor) {
<span class="nc" id="L57">    this.cellEditor = cellEditor;</span>
<span class="nc" id="L58">  }</span>

  public void setActionListener(Gui4jActionListenerComboBox listener) {
<span class="nc" id="L61">    actionListener = listener;</span>
<span class="nc" id="L62">    addActionListener(actionListener);</span>
<span class="nc" id="L63">  }</span>

  public Gui4jActionListenerComboBox getActionListener() {
<span class="nc" id="L66">    return actionListener;</span>
  }

  private void enableHorizontalScrollbar(ComboBoxUI comboUI) {
<span class="nc bnc" id="L70" title="All 2 branches missed.">    if (comboUI instanceof BasicComboBoxUI) {</span>
      try {
<span class="nc" id="L72">        Field popupField = BasicComboBoxUI.class.getDeclaredField(&quot;popup&quot;);</span>
<span class="nc" id="L73">        popupField.setAccessible(true);</span>
<span class="nc" id="L74">        ComboPopup popup = (ComboPopup) popupField.get(comboUI);</span>
<span class="nc bnc" id="L75" title="All 2 branches missed.">        if (popup instanceof BasicComboPopup) {</span>
<span class="nc" id="L76">          Field scrollerField = BasicComboPopup.class.getDeclaredField(&quot;scroller&quot;);</span>
<span class="nc" id="L77">          scrollerField.setAccessible(true);</span>
<span class="nc" id="L78">          JScrollPane scroller = (JScrollPane) scrollerField.get(popup);</span>
<span class="nc" id="L79">          scroller.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED);</span>
<span class="nc bnc" id="L80" title="All 2 branches missed.">          if (scroller.getHorizontalScrollBar() == null) {</span>
            // workaround for JDK 1.5 Comboboxes that explicitly set their horizontal scrollbars to
            // null
<span class="nc" id="L83">            JScrollBar scrollBar = new JScrollBar(JScrollBar.HORIZONTAL);</span>
<span class="nc" id="L84">            scroller.setHorizontalScrollBar(scrollBar);</span>
          }
<span class="nc" id="L86">          scroller.getHorizontalScrollBar().setFocusable(false);</span>
        }
<span class="nc" id="L88">      } catch (Exception e) {</span>
<span class="nc" id="L89">        log.warn(&quot;Could not enable horizontal scrollbar for combobox.&quot;, e);</span>
<span class="nc" id="L90">      }</span>
    }
<span class="nc" id="L92">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>