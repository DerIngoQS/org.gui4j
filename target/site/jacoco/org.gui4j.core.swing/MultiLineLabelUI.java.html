<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MultiLineLabelUI.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core.swing</a> &gt; <span class="el_source">MultiLineLabelUI.java</span></div><h1>MultiLineLabelUI.java</h1><pre class="source lang-java linenums">package org.gui4j.core.swing;

import java.awt.Dimension;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.Rectangle;
import java.util.StringTokenizer;
import javax.swing.Icon;
import javax.swing.JComponent;
import javax.swing.JLabel;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.plaf.LabelUI;
import javax.swing.plaf.basic.BasicGraphicsUtils;
import javax.swing.plaf.basic.BasicLabelUI;

<span class="nc" id="L17">public class MultiLineLabelUI extends BasicLabelUI {</span>
  static {
<span class="nc" id="L19">    labelUI = new MultiLineLabelUI();</span>
<span class="nc" id="L20">  }</span>

  public static LabelUI getInstance() {
<span class="nc" id="L23">    return labelUI;</span>
  }

  protected String layoutCL(
      JLabel label,
      FontMetrics fontMetrics,
      String text,
      Icon icon,
      Rectangle viewR,
      Rectangle iconR,
      Rectangle textR) {
<span class="nc" id="L34">    String s =</span>
<span class="nc" id="L35">        layoutCompoundLabel(</span>
            label,
            fontMetrics,
<span class="nc" id="L38">            splitStringByLines(text),</span>
            icon,
<span class="nc" id="L40">            label.getVerticalAlignment(),</span>
<span class="nc" id="L41">            label.getHorizontalAlignment(),</span>
<span class="nc" id="L42">            label.getVerticalTextPosition(),</span>
<span class="nc" id="L43">            label.getHorizontalTextPosition(),</span>
            viewR,
            iconR,
            textR,
<span class="nc" id="L47">            label.getIconTextGap());</span>

<span class="nc bnc" id="L49" title="All 2 branches missed.">    if (s.equals(&quot;&quot;)) return text;</span>
<span class="nc" id="L50">    return s;</span>
  }

  static final int LEADING = SwingConstants.LEADING;
  static final int TRAILING = SwingConstants.TRAILING;
  static final int LEFT = SwingConstants.LEFT;
  static final int RIGHT = SwingConstants.RIGHT;
  static final int TOP = SwingConstants.TOP;
  static final int CENTER = SwingConstants.CENTER;

  /**
   * Compute and return the location of the icons origin, the location of origin of the text
   * baseline, and a possibly clipped version of the compound labels string. Locations are computed
   * relative to the viewR rectangle. The JComponents orientation (LEADING/TRAILING) will also be
   * taken into account and translated into LEFT/RIGHT values accordingly.
   *
   * @param c
   * @param fm
   * @param text
   * @param icon
   * @param verticalAlignment
   * @param horizontalAlignment
   * @param verticalTextPosition
   * @param horizontalTextPosition
   * @param viewR
   * @param iconR
   * @param textR
   * @param textIconGap
   * @return String
   */
  public static String layoutCompoundLabel(
      JComponent c,
      FontMetrics fm,
      String[] text,
      Icon icon,
      int verticalAlignment,
      int horizontalAlignment,
      int verticalTextPosition,
      int horizontalTextPosition,
      Rectangle viewR,
      Rectangle iconR,
      Rectangle textR,
      int textIconGap) {
<span class="nc" id="L93">    boolean orientationIsLeftToRight = true;</span>
<span class="nc" id="L94">    int hAlign = horizontalAlignment;</span>
<span class="nc" id="L95">    int hTextPos = horizontalTextPosition;</span>

<span class="nc bnc" id="L97" title="All 2 branches missed.">    if (c != null) {</span>
<span class="nc bnc" id="L98" title="All 2 branches missed.">      if (!(c.getComponentOrientation().isLeftToRight())) {</span>
<span class="nc" id="L99">        orientationIsLeftToRight = false;</span>
      }
    }

    // Translate LEADING/TRAILING values in horizontalAlignment
    // to LEFT/RIGHT values depending on the components orientation
<span class="nc bnc" id="L105" title="All 3 branches missed.">    switch (horizontalAlignment) {</span>
      case LEADING:
<span class="nc bnc" id="L107" title="All 2 branches missed.">        hAlign = (orientationIsLeftToRight) ? LEFT : RIGHT;</span>
<span class="nc" id="L108">        break;</span>
      case TRAILING:
<span class="nc bnc" id="L110" title="All 2 branches missed.">        hAlign = (orientationIsLeftToRight) ? RIGHT : LEFT;</span>
        break;
    }

    // Translate LEADING/TRAILING values in horizontalTextPosition
    // to LEFT/RIGHT values depending on the components orientation
<span class="nc bnc" id="L116" title="All 3 branches missed.">    switch (horizontalTextPosition) {</span>
      case LEADING:
<span class="nc bnc" id="L118" title="All 2 branches missed.">        hTextPos = (orientationIsLeftToRight) ? LEFT : RIGHT;</span>
<span class="nc" id="L119">        break;</span>
      case TRAILING:
<span class="nc bnc" id="L121" title="All 2 branches missed.">        hTextPos = (orientationIsLeftToRight) ? RIGHT : LEFT;</span>
        break;
    }

<span class="nc" id="L125">    return layoutCompoundLabel(</span>
        fm,
        text,
        icon,
        verticalAlignment,
        hAlign,
        verticalTextPosition,
        hTextPos,
        viewR,
        iconR,
        textR,
        textIconGap);
  }

  /**
   * Compute and return the location of the icons origin, the location of origin of the text
   * baseline, and a possibly clipped version of the compound labels string. Locations are computed
   * relative to the viewR rectangle. This layoutCompoundLabel() does not know how to handle
   * LEADING/TRAILING values in horizontalTextPosition (they will default to RIGHT) and in
   * horizontalAlignment (they will default to CENTER). Use the other version of
   * layoutCompoundLabel() instead.
   *
   * @param fm
   * @param text
   * @param icon
   * @param verticalAlignment
   * @param horizontalAlignment
   * @param verticalTextPosition
   * @param horizontalTextPosition
   * @param viewR
   * @param iconR
   * @param textR
   * @param textIconGap
   * @return String
   */
  public static String layoutCompoundLabel(
      FontMetrics fm,
      String[] text,
      Icon icon,
      int verticalAlignment,
      int horizontalAlignment,
      int verticalTextPosition,
      int horizontalTextPosition,
      Rectangle viewR,
      Rectangle iconR,
      Rectangle textR,
      int textIconGap) {
    /* Initialize the icon bounds rectangle iconR.
     */

<span class="nc bnc" id="L175" title="All 2 branches missed.">    if (icon != null) {</span>
<span class="nc" id="L176">      iconR.width = icon.getIconWidth();</span>
<span class="nc" id="L177">      iconR.height = icon.getIconHeight();</span>
    } else {
<span class="nc" id="L179">      iconR.width = iconR.height = 0;</span>
    }

    /* Initialize the text bounds rectangle textR.  If a null
     * or and empty String was specified we substitute &quot;&quot; here
     * and use 0,0,0,0 for textR.
     */

    // Fix for textIsEmpty sent by Paulo Santos
<span class="nc bnc" id="L188" title="All 8 branches missed.">    boolean textIsEmpty =</span>
        (text == null)
            || (text.length == 0)
<span class="nc bnc" id="L191" title="All 2 branches missed.">            || (text.length == 1 &amp;&amp; ((text[0] == null) || text[0].equals(&quot;&quot;)));</span>

<span class="nc" id="L193">    String rettext = &quot;&quot;;</span>
<span class="nc bnc" id="L194" title="All 2 branches missed.">    if (textIsEmpty) {</span>
<span class="nc" id="L195">      textR.width = textR.height = 0;</span>
    } else {
<span class="nc" id="L197">      Dimension dim = computeMultiLineDimension(fm, text);</span>
<span class="nc" id="L198">      textR.width = dim.width;</span>
<span class="nc" id="L199">      textR.height = dim.height;</span>
    }

    /* Unless both text and icon are non-null, we effectively ignore
     * the value of textIconGap.  The code that follows uses the
     * value of gap instead of textIconGap.
     */

<span class="nc bnc" id="L207" title="All 4 branches missed.">    int gap = (textIsEmpty || (icon == null)) ? 0 : textIconGap;</span>

<span class="nc bnc" id="L209" title="All 2 branches missed.">    if (!textIsEmpty) {</span>

      /* If the label text string is too wide to fit within the available
       * space &quot;...&quot; and as many characters as will fit will be
       * displayed instead.
       */

      int availTextWidth;

<span class="nc bnc" id="L218" title="All 2 branches missed.">      if (horizontalTextPosition == CENTER) {</span>
<span class="nc" id="L219">        availTextWidth = viewR.width;</span>
      } else {
<span class="nc" id="L221">        availTextWidth = viewR.width - (iconR.width + gap);</span>
      }

<span class="nc bnc" id="L224" title="All 4 branches missed.">      if (textR.width &gt; availTextWidth &amp;&amp; text.length == 1) {</span>
<span class="nc" id="L225">        String clipString = &quot;...&quot;;</span>
<span class="nc" id="L226">        int totalWidth = SwingUtilities.computeStringWidth(fm, clipString);</span>
        int nChars;
<span class="nc bnc" id="L228" title="All 2 branches missed.">        for (nChars = 0; nChars &lt; text[0].length(); nChars++) {</span>
<span class="nc" id="L229">          totalWidth += fm.charWidth(text[0].charAt(nChars));</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">          if (totalWidth &gt; availTextWidth) {</span>
<span class="nc" id="L231">            break;</span>
          }
        }
<span class="nc" id="L234">        rettext = text[0].substring(0, nChars) + clipString;</span>
<span class="nc" id="L235">        textR.width = SwingUtilities.computeStringWidth(fm, rettext);</span>
      }
    }

    /* Compute textR.x,y given the verticalTextPosition and
     * horizontalTextPosition properties
     */

<span class="nc bnc" id="L243" title="All 2 branches missed.">    if (verticalTextPosition == TOP) {</span>
<span class="nc bnc" id="L244" title="All 2 branches missed.">      if (horizontalTextPosition != CENTER) {</span>
<span class="nc" id="L245">        textR.y = 0;</span>
      } else {
<span class="nc" id="L247">        textR.y = -(textR.height + gap);</span>
      }
<span class="nc bnc" id="L249" title="All 2 branches missed.">    } else if (verticalTextPosition == CENTER) {</span>
<span class="nc" id="L250">      textR.y = (iconR.height / 2) - (textR.height / 2);</span>
    } else { // (verticalTextPosition == BOTTOM)
<span class="nc bnc" id="L252" title="All 2 branches missed.">      if (horizontalTextPosition != CENTER) {</span>
<span class="nc" id="L253">        textR.y = iconR.height - textR.height;</span>
      } else {
<span class="nc" id="L255">        textR.y = (iconR.height + gap);</span>
      }
    }

<span class="nc bnc" id="L259" title="All 2 branches missed.">    if (horizontalTextPosition == LEFT) {</span>
<span class="nc" id="L260">      textR.x = -(textR.width + gap);</span>
<span class="nc bnc" id="L261" title="All 2 branches missed.">    } else if (horizontalTextPosition == CENTER) {</span>
<span class="nc" id="L262">      textR.x = (iconR.width / 2) - (textR.width / 2);</span>
    } else { // (horizontalTextPosition == RIGHT)
<span class="nc" id="L264">      textR.x = (iconR.width + gap);</span>
    }

    /* labelR is the rectangle that contains iconR and textR.
     * Move it to its proper position given the labelAlignment
     * properties.
     *
     * To avoid actually allocating a Rectangle, Rectangle.union
     * has been inlined below.
     */
<span class="nc" id="L274">    int labelR_x = Math.min(iconR.x, textR.x);</span>
<span class="nc" id="L275">    int labelR_width = Math.max(iconR.x + iconR.width, textR.x + textR.width) - labelR_x;</span>
<span class="nc" id="L276">    int labelR_y = Math.min(iconR.y, textR.y);</span>
<span class="nc" id="L277">    int labelR_height = Math.max(iconR.y + iconR.height, textR.y + textR.height) - labelR_y;</span>

    int dx, dy;

<span class="nc bnc" id="L281" title="All 2 branches missed.">    if (verticalAlignment == TOP) {</span>
<span class="nc" id="L282">      dy = viewR.y - labelR_y;</span>
<span class="nc bnc" id="L283" title="All 2 branches missed.">    } else if (verticalAlignment == CENTER) {</span>
<span class="nc" id="L284">      dy = (viewR.y + (viewR.height / 2)) - (labelR_y + (labelR_height / 2));</span>
    } else { // (verticalAlignment == BOTTOM)
<span class="nc" id="L286">      dy = (viewR.y + viewR.height) - (labelR_y + labelR_height);</span>
    }

<span class="nc bnc" id="L289" title="All 2 branches missed.">    if (horizontalAlignment == LEFT) {</span>
<span class="nc" id="L290">      dx = viewR.x - labelR_x;</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">    } else if (horizontalAlignment == RIGHT) {</span>
<span class="nc" id="L292">      dx = (viewR.x + viewR.width) - (labelR_x + labelR_width);</span>
    } else { // (horizontalAlignment == CENTER)
<span class="nc" id="L294">      dx = (viewR.x + (viewR.width / 2)) - (labelR_x + (labelR_width / 2));</span>
    }

    /* Translate textR and glypyR by dx,dy.
     */

<span class="nc" id="L300">    textR.x += dx;</span>
<span class="nc" id="L301">    textR.y += dy;</span>

<span class="nc" id="L303">    iconR.x += dx;</span>
<span class="nc" id="L304">    iconR.y += dy;</span>

<span class="nc" id="L306">    return rettext;</span>
  }

  protected void paintEnabledText(JLabel l, Graphics g, String s, int textX, int textY) {
<span class="nc" id="L310">    int accChar = l.getDisplayedMnemonic();</span>
<span class="nc" id="L311">    g.setColor(l.getForeground());</span>
<span class="nc" id="L312">    drawString(g, s, accChar, textX, textY);</span>
<span class="nc" id="L313">  }</span>

  protected void paintDisabledText(JLabel l, Graphics g, String s, int textX, int textY) {
<span class="nc" id="L316">    int accChar = l.getDisplayedMnemonic();</span>
<span class="nc" id="L317">    g.setColor(l.getBackground());</span>
<span class="nc" id="L318">    drawString(g, s, accChar, textX, textY);</span>
<span class="nc" id="L319">  }</span>

  protected void drawString(Graphics g, String s, int accChar, int textX, int textY) {
<span class="nc bnc" id="L322" title="All 2 branches missed.">    if (s.indexOf('\n') == -1) BasicGraphicsUtils.drawString(g, s, accChar, textX, textY);</span>
    else {
<span class="nc" id="L324">      String[] lStrs = splitStringByLines(s);</span>
<span class="nc" id="L325">      int height = g.getFontMetrics().getHeight();</span>
      // Only the first line can have the accel char
<span class="nc" id="L327">      BasicGraphicsUtils.drawString(g, lStrs[0], accChar, textX, textY);</span>
<span class="nc bnc" id="L328" title="All 2 branches missed.">      for (int i = 1; i &lt; lStrs.length; i++) g.drawString(lStrs[i], textX, textY + (height * i));</span>
    }
<span class="nc" id="L330">  }</span>

  public static Dimension computeMultiLineDimension(FontMetrics fm, String[] strs) {
<span class="nc" id="L333">    int i, c, width = 0;</span>
<span class="nc bnc" id="L334" title="All 2 branches missed.">    for (i = 0, c = strs.length; i &lt; c; i++)</span>
<span class="nc" id="L335">      width = Math.max(width, SwingUtilities.computeStringWidth(fm, strs[i]));</span>
<span class="nc" id="L336">    return new Dimension(width, fm.getHeight() * strs.length);</span>
  }

  protected String str;
  protected String[] strs;

  public String[] splitStringByLines(String pStr) {
<span class="nc bnc" id="L343" title="All 2 branches missed.">    if (pStr.equals(this.str)) return strs;</span>

<span class="nc" id="L345">    this.str = pStr;</span>

<span class="nc" id="L347">    int lines = 1;</span>
    int i, c;
<span class="nc bnc" id="L349" title="All 2 branches missed.">    for (i = 0, c = pStr.length(); i &lt; c; i++) {</span>
<span class="nc bnc" id="L350" title="All 2 branches missed.">      if (pStr.charAt(i) == '\n') lines++;</span>
    }
<span class="nc" id="L352">    strs = new String[lines];</span>
<span class="nc" id="L353">    StringTokenizer st = new StringTokenizer(pStr, &quot;\n&quot;);</span>

<span class="nc" id="L355">    int line = 0;</span>
<span class="nc bnc" id="L356" title="All 2 branches missed.">    while (st.hasMoreTokens()) strs[line++] = st.nextToken();</span>

<span class="nc" id="L358">    return strs;</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>