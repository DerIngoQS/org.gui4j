<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MathCalc.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core.util</a> &gt; <span class="el_source">MathCalc.java</span></div><h1>MathCalc.java</h1><pre class="source lang-java linenums">package org.gui4j.core.util;

/**
 * This is the main source code for calculator written in Java 1.1 This program emulates a &quot;real&quot;
 * calculator in that is has a simular user interface arranged in a standard order. It provides an
 * advantage over most of the other calculators because you can viewer both the equation and the
 * results at the same time and allows for editing of the entered equation. Also this calculator
 * adheres to the rules of arithmetic where equation are evaluated in the order brackets, exponents,
 * multiplication, division, addition and subtraction.
 */
<span class="nc" id="L11">public class MathCalc {</span>
<span class="nc" id="L12">  String display = &quot;&quot;;</span>

  /**
   * This method clears all brackets from the expression beginning with the inner most bracket and
   * working outwords and from left to right for non nested brackets.
   *
   * @param swb
   * @return String
   */
  private static String brackets(String swb) {
    int lb; // holds the position of the left bracket
    int index; // gives position of the character under evaulation
<span class="nc" id="L24">    int count = 1; // variable used to determine when left bracket is closed</span>
    char cb;
<span class="nc" id="L26">    String inside = &quot;&quot;;</span>

<span class="nc" id="L28">    lb = swb.indexOf('(');</span>
<span class="nc" id="L29">    index = lb;</span>

<span class="nc bnc" id="L31" title="All 2 branches missed.">    while (index &lt; swb.length()) {</span>
<span class="nc" id="L32">      cb = swb.charAt(++index);</span>

<span class="nc bnc" id="L34" title="All 2 branches missed.">      if (cb == '(') {</span>
<span class="nc" id="L35">        count++; // count how many closing bracket needed</span>
<span class="nc bnc" id="L36" title="All 2 branches missed.">      } else if (cb == ')') {</span>
<span class="nc" id="L37">        count--; // count how many closing bracket needed</span>
      }
<span class="nc bnc" id="L39" title="All 4 branches missed.">      if (cb == ')' &amp;&amp; count == 0) { // bracket has been closed</span>
<span class="nc" id="L40">        inside = swb.substring(lb + 1, index); // contents inside the bracket</span>
<span class="nc" id="L41">        break;</span>
      }
    }

    // send the contenst inside the bracket to be evalutated with one less
    // set of brackets
<span class="nc bnc" id="L47" title="All 2 branches missed.">    if (lb &gt; 0) {</span>
<span class="nc" id="L48">      swb = swb.substring(0, lb) + evaluate(inside) + swb.substring(index + 1, swb.length());</span>
    } else {
<span class="nc" id="L50">      swb = evaluate(inside) + swb.substring(index + 1, swb.length());</span>
    }

<span class="nc" id="L53">    return swb;</span>
  }

  /**
   * This method is the controlling method for the evaluation of the mathematical equations
   *
   * @param s
   * @return String
   */
  public static String evaluate(String s) {
<span class="nc" id="L63">    int n = 0;</span>

    // insert * where implicit multiplication is assumed
<span class="nc" id="L66">    s = insertMultiply(s);</span>

    // determine if either e or pi are in the equation replace with numbers
<span class="nc bnc" id="L69" title="All 2 branches missed.">    if (s.indexOf('e') + s.indexOf(&quot;pi&quot;) &gt; -2) {</span>
<span class="nc" id="L70">      s = constants(s);</span>
    }

<span class="nc bnc" id="L73" title="All 2 branches missed.">    while (s.indexOf('(') != -1) // evaulate inside bracket first if present</span>
    {
<span class="nc" id="L75">      s = brackets(s);</span>
    }
<span class="nc bnc" id="L77" title="All 2 branches missed.">    if (s.indexOf('^') != -1) // next evaluate all the exponents</span>
    {
<span class="nc" id="L79">      s = exponent(s);</span>
    }
<span class="nc" id="L81">    s = func(s); // functions such as cos, sin, log etc.</span>

<span class="nc" id="L83">    s = resolve(s); // eliminate the combination of sigs etc +-</span>
<span class="nc bnc" id="L84" title="All 4 branches missed.">    if (s.indexOf('*') != -1 || s.indexOf('/') != -1) {</span>
<span class="nc" id="L85">      s = mult(s);</span>
    }
<span class="nc" id="L87">    s = resolve(s);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">    if (s.indexOf('+') != -1) {</span>
<span class="nc" id="L89">      s = sum(s); // do all the addition in the equation</span>
    } else {
<span class="nc" id="L91">      n = s.indexOf('-', n);</span>
      // evaluate all the substraction in the equation
<span class="nc bnc" id="L93" title="All 2 branches missed.">      while (n != -1) {</span>
<span class="nc bnc" id="L94" title="All 2 branches missed.">        if (n != 0) {</span>
<span class="nc bnc" id="L95" title="All 2 branches missed.">          if (s.charAt(n - 1) != 'E') { // make sure that - sign not part of</span>
            // exponent
<span class="nc" id="L97">            s = sum(s);</span>
<span class="nc" id="L98">            break;</span>
          }
        }
<span class="nc" id="L101">        n = s.indexOf('-', n + 1);</span>
      }
    }
<span class="nc" id="L104">    return s; // return the final answer</span>
  }

  /**
   * this method replaces constant variable such as e and pe with there numeric values 2.71818...
   * and 3.141259...
   *
   * @param swc
   * @return String
   */
  private static String constants(String swc) {
    int a, b;
<span class="nc" id="L116">    a = swc.indexOf('e');</span>

<span class="nc bnc" id="L118" title="All 2 branches missed.">    if (a != -1) {</span>
<span class="nc" id="L119">      swc = swc.substring(0, a) + Math.E + swc.substring(a + 1, swc.length());</span>
    }

<span class="nc" id="L122">    b = swc.indexOf(&quot;pi&quot;);</span>
<span class="nc bnc" id="L123" title="All 2 branches missed.">    if (b != -1) {</span>
<span class="nc" id="L124">      swc = swc.substring(0, b) + Math.PI + swc.substring(b + 2, swc.length());</span>
    }

<span class="nc bnc" id="L127" title="All 2 branches missed.">    if (swc.indexOf('e') + swc.indexOf(&quot;pi&quot;) &gt; -2) {</span>
<span class="nc" id="L128">      return constants(swc);</span>
    } else {
<span class="nc" id="L130">      return swc;</span>
    }
  }

  /**
   * This method evaluates a string containing only addition and subtraction from left to right
   *
   * @param s
   * @return String
   */
  private static String sum(String s) {
    double dub1, dub2, result;
    char operation, c;
<span class="nc" id="L143">    int i = 0, n = 1;</span>
<span class="nc" id="L144">    String num1 = &quot;&quot;, num2 = &quot;&quot;;</span>

<span class="nc" id="L146">    c = s.charAt(0);</span>
<span class="nc bnc" id="L147" title="All 2 branches missed.">    if (c == '-') { // test if equation starts with a -ve</span>
<span class="nc" id="L148">      i++;</span>
<span class="nc" id="L149">      c = s.charAt(i);</span>
<span class="nc" id="L150">      n = -1;</span>
    }

    // find the first number
<span class="nc bnc" id="L154" title="All 10 branches missed.">    while (Character.isDigit(c) || c == '.' || c == 'E' || (c == '-' &amp;&amp; s.charAt(i - 1) == 'E')) {</span>
<span class="nc" id="L155">      num1 += c;</span>
<span class="nc" id="L156">      i++;</span>
<span class="nc" id="L157">      c = s.charAt(i);</span>
    }

    // next character determines the operation that will be performed
<span class="nc" id="L161">    operation = c;</span>
<span class="nc" id="L162">    i++;</span>
<span class="nc" id="L163">    c = s.charAt(i);</span>
<span class="nc" id="L164">    num2 += c;</span>

    // find the number after the operator
<span class="nc bnc" id="L167" title="All 10 branches missed.">    while ((Character.isDigit(c) || c == '.' || c == 'E' || (c == '-' &amp;&amp; s.charAt(i - 1) == 'E'))</span>
<span class="nc bnc" id="L168" title="All 2 branches missed.">        &amp;&amp; i &lt; s.length() - 1) {</span>
<span class="nc" id="L169">      c = s.charAt(++i);</span>
<span class="nc bnc" id="L170" title="All 6 branches missed.">      if (c == '+' || (c == '-' &amp;&amp; (s.charAt(i - 1) != 'E'))) {</span>
<span class="nc" id="L171">        break;</span>
      }
<span class="nc" id="L173">      num2 += c;</span>
    }

    // convert the numbers to double values
<span class="nc" id="L177">    dub1 = Double.valueOf(num1).doubleValue() * n;</span>
<span class="nc" id="L178">    dub2 = Double.valueOf(num2).doubleValue();</span>

<span class="nc bnc" id="L180" title="All 2 branches missed.">    if (operation == '+') {</span>
<span class="nc" id="L181">      result = dub1 + dub2;</span>
    } else {
<span class="nc" id="L183">      result = dub1 - dub2;</span>
    }

<span class="nc bnc" id="L186" title="All 2 branches missed.">    if (i == s.length() - 1) {</span>
<span class="nc" id="L187">      s = String.valueOf(result);</span>
<span class="nc" id="L188">      return s;</span>
    } else {
<span class="nc" id="L190">      s = String.valueOf(result) + s.substring(i, s.length());</span>
<span class="nc" id="L191">      return sum(s);</span>
    }
  }

  /**
   * This method deals with multiplication and division in a string and
   *
   * @param s
   * @return String
   */
  private static String mult(String s) {
    int m, d, start, left, index;
    boolean multiply;
    double dub1, dub2, answer;
    char c;
<span class="nc" id="L206">    String num1 = &quot;&quot;, num2 = &quot;&quot;;</span>

<span class="nc" id="L208">    m = s.indexOf('*');</span>
<span class="nc" id="L209">    d = s.indexOf('/');</span>

    // determine if multiplication or division
<span class="nc bnc" id="L212" title="All 8 branches missed.">    if (((m &lt; d) &amp;&amp; (m != -1)) || ((m &gt; d) &amp;&amp; (d == -1))) {</span>
<span class="nc" id="L213">      start = m;</span>
<span class="nc" id="L214">      multiply = true;</span>
    } else {
<span class="nc" id="L216">      start = d;</span>
<span class="nc" id="L217">      multiply = false;</span>
    }

<span class="nc" id="L220">    index = start - 1;</span>
<span class="nc" id="L221">    c = s.charAt(index);</span>

    // determine the value of num1
<span class="nc bnc" id="L224" title="All 10 branches missed.">    while (Character.isDigit(c)</span>
        || c == '.'
        || (index == 0)
        || c == 'E'
<span class="nc bnc" id="L228" title="All 2 branches missed.">        || (c == '-' &amp;&amp; s.charAt(index - 1) == 'E')) {</span>
<span class="nc" id="L229">      num1 = c + num1;</span>
<span class="nc bnc" id="L230" title="All 2 branches missed.">      if (index == 0) {</span>
<span class="nc" id="L231">        break;</span>
      }
<span class="nc" id="L233">      c = s.charAt(--index);</span>
    }

<span class="nc bnc" id="L236" title="All 2 branches missed.">    if (index == 0) {</span>
<span class="nc" id="L237">      left = 0;</span>
    } else {
<span class="nc" id="L239">      left = ++index;</span>
    }

<span class="nc" id="L242">    index = start + 1;</span>
<span class="nc" id="L243">    c = s.charAt(index);</span>

    // determine the value of num2
<span class="nc bnc" id="L246" title="All 10 branches missed.">    while (Character.isDigit(c)</span>
        || c == '.'
        || ((index == start + 1) &amp;&amp; (c == '-'))
<span class="nc bnc" id="L249" title="All 2 branches missed.">        || (c == '-' &amp;&amp; s.charAt(index - 1) == 'E')) {</span>
<span class="nc" id="L250">      num2 += c;</span>
<span class="nc bnc" id="L251" title="All 2 branches missed.">      if (index == s.length() - 1) {</span>
<span class="nc" id="L252">        break;</span>
      }
<span class="nc" id="L254">      c = s.charAt(++index);</span>
    }

    //  perform calculation

<span class="nc" id="L259">    dub1 = Double.valueOf(num1).doubleValue();</span>
<span class="nc" id="L260">    dub2 = Double.valueOf(num2).doubleValue();</span>

<span class="nc bnc" id="L262" title="All 2 branches missed.">    if (multiply) {</span>
<span class="nc" id="L263">      answer = dub1 * dub2;</span>
    } else {
<span class="nc" id="L265">      answer = dub1 / dub2;</span>
    }

    // insert the answer into the equation
<span class="nc bnc" id="L269" title="All 2 branches missed.">    if (index == s.length() - 1) {</span>
<span class="nc" id="L270">      s = s.substring(0, left) + String.valueOf(answer);</span>
    } else {
<span class="nc" id="L272">      s = s.substring(0, left) + String.valueOf(answer) + s.substring(index, s.length());</span>
    }

<span class="nc bnc" id="L275" title="All 4 branches missed.">    if (s.indexOf('*') != -1 || s.indexOf('/') != -1) {</span>
<span class="nc" id="L276">      return mult(s);</span>
    } else {
<span class="nc" id="L278">      return s;</span>
    }
  }

  /**
   * This method deals with exponents in the string
   *
   * @param se
   * @return String
   */
  private static String exponent(String se) {
<span class="nc" id="L289">    int index, m, k = 1, left;</span>
    char ce;
    double base, power, result;
<span class="nc" id="L292">    String num1 = &quot;&quot;, num2 = &quot;&quot;;</span>

<span class="nc" id="L294">    m = se.indexOf('^'); // index of the exponent operator</span>
<span class="nc" id="L295">    index = m - 1;</span>
<span class="nc" id="L296">    ce = se.charAt(index); // char that is under investiogation</span>

    // find the value of the base
<span class="nc bnc" id="L299" title="All 8 branches missed.">    while (Character.isDigit(ce)</span>
        || ce == '.'
        || ce == 'E'
<span class="nc bnc" id="L302" title="All 2 branches missed.">        || (ce == '-' &amp;&amp; se.charAt(index - 1) == 'E')) {</span>
<span class="nc" id="L303">      num1 = ce + num1; // append the character before the #</span>
<span class="nc bnc" id="L304" title="All 2 branches missed.">      if (index == 0) {</span>
<span class="nc" id="L305">        break;</span>
      }

<span class="nc" id="L308">      ce = se.charAt(--index);</span>
    }

    // determine if the base is a negative number
<span class="nc bnc" id="L312" title="All 6 branches missed.">    if ((index &gt; 1) &amp;&amp; (se.charAt(index) == '-') &amp;&amp; !(Character.isDigit(se.charAt(index - 1)))) {</span>
<span class="nc" id="L313">      k = -1;</span>
<span class="nc" id="L314">      left = index;</span>
<span class="nc bnc" id="L315" title="All 2 branches missed.">    } else if (index == 0) {</span>
<span class="nc bnc" id="L316" title="All 2 branches missed.">      if (ce == '-') {</span>
<span class="nc" id="L317">        k = -1;</span>
      }
<span class="nc" id="L319">      left = 0;</span>
    } else {
<span class="nc" id="L321">      left = index + 1;</span>
    }

<span class="nc" id="L324">    index = m + 1;</span>
<span class="nc" id="L325">    ce = se.charAt(index);</span>

    // find the value of the exponent
<span class="nc bnc" id="L328" title="All 12 branches missed.">    while ((Character.isDigit(ce) || (ce == '-' &amp;&amp; index == m + 1) || ce == '.')</span>
        || ce == 'E'
<span class="nc bnc" id="L330" title="All 2 branches missed.">        || (ce == '-' &amp;&amp; se.charAt(index - 1) == 'E')) {</span>
<span class="nc" id="L331">      num2 += ce;</span>
<span class="nc bnc" id="L332" title="All 2 branches missed.">      if (index == se.length() - 1) {</span>
<span class="nc" id="L333">        break;</span>
      }
<span class="nc" id="L335">      ce = se.charAt(++index);</span>
    }

    // convert num1 and num2 to doubles and evaluate the result
<span class="nc" id="L339">    base = Double.valueOf(num1).doubleValue() * k;</span>
<span class="nc" id="L340">    power = Double.valueOf(num2).doubleValue();</span>
<span class="nc" id="L341">    result = Math.pow(base, power);</span>
    // insert the result into the equation
<span class="nc" id="L343">    se = replace(se, left, index, result);</span>

<span class="nc bnc" id="L345" title="All 2 branches missed.">    if (se.indexOf('^') != -1) {</span>
<span class="nc" id="L346">      return exponent(se);</span>
    } else {
<span class="nc" id="L348">      return se;</span>
    }
  }

  /**
   * This method evaluates all the functions in the expression filler line to see what happens
   * another filler line a third filler line
   *
   * @param sf
   * @return String
   */
  private static String func(String sf) {
<span class="nc" id="L360">    int total = 0, temp;</span>
<span class="nc" id="L361">    String fnctn[] = {&quot;sin&quot;, &quot;cos&quot;, &quot;tan&quot;, &quot;log&quot;, &quot;ln&quot;, &quot;sqrt&quot;, &quot;!&quot;}, temp2 = &quot;&quot;;</span>
    // array that holds the names of funcs.
<span class="nc" id="L363">    int pos[] = new int[7]; // array that will hold the pos. of funcs.</span>

<span class="nc bnc" id="L365" title="All 2 branches missed.">    for (int n = 0; n &lt; fnctn.length; n++) {</span>
<span class="nc" id="L366">      pos[n] = sf.lastIndexOf(fnctn[n]); // initialize array</span>
    }

<span class="nc bnc" id="L369" title="All 2 branches missed.">    for (int m = 0; m &lt; fnctn.length; m++) {</span>
<span class="nc" id="L370">      total += pos[m]; // find total of all the position values</span>
    }

<span class="nc bnc" id="L373" title="All 2 branches missed.">    if (total == -7) // determine if the equation holds any functions</span>
    {
<span class="nc" id="L375">      return sf; // equation does not have any functions so return</span>
    }

    // sort the array to ensure that the functions are evaluated from
    // right to left so that functions can be nested
<span class="nc bnc" id="L380" title="All 2 branches missed.">    for (int i = pos.length; i &gt; 1; i--) {</span>
<span class="nc bnc" id="L381" title="All 2 branches missed.">      for (int j = 0; j &lt; i - 1; j++) {</span>

<span class="nc bnc" id="L383" title="All 2 branches missed.">        if (pos[j] &lt; pos[j + 1]) { // sort the arrays</span>
<span class="nc" id="L384">          temp = pos[j];</span>
<span class="nc" id="L385">          pos[j] = pos[j + 1];</span>
<span class="nc" id="L386">          pos[j + 1] = temp;</span>

<span class="nc" id="L388">          temp2 = fnctn[j];</span>
<span class="nc" id="L389">          fnctn[j] = fnctn[j + 1];</span>
<span class="nc" id="L390">          fnctn[j + 1] = temp2;</span>
        }
      }
    }

    // find the right most function and evaluate it and puts its
    // numeric equivalent in the equation
<span class="nc bnc" id="L397" title="All 2 branches missed.">    if (fnctn[0].equals(&quot;sin&quot;)) {</span>
<span class="nc bnc" id="L398" title="All 4 branches missed.">      if ((pos[0] == 0 || sf.charAt(pos[0] - 1) != 'a')) {</span>
<span class="nc" id="L399">        return func(Functions.sine(sf, pos[0], false));</span>
      } else {
<span class="nc" id="L401">        return func(Functions.asin(sf, pos[0], false));</span>
      }
<span class="nc bnc" id="L403" title="All 2 branches missed.">    } else if (fnctn[0].equals(&quot;cos&quot;)) {</span>
<span class="nc bnc" id="L404" title="All 4 branches missed.">      if ((pos[0] == 0 || sf.charAt(pos[0] - 1) != 'a')) {</span>
<span class="nc" id="L405">        return func(Functions.cosine(sf, pos[0], false));</span>
      } else {
<span class="nc" id="L407">        return func(Functions.acos(sf, pos[0], false));</span>
      }
<span class="nc bnc" id="L409" title="All 2 branches missed.">    } else if (fnctn[0].equals(&quot;tan&quot;)) {</span>
<span class="nc bnc" id="L410" title="All 4 branches missed.">      if ((pos[0] == 0 || sf.charAt(pos[0] - 1) != 'a')) {</span>
<span class="nc" id="L411">        return func(Functions.tangent(sf, pos[0], false));</span>
      } else {
<span class="nc" id="L413">        return func(Functions.atan(sf, pos[0], false));</span>
      }
<span class="nc bnc" id="L415" title="All 2 branches missed.">    } else if (fnctn[0].equals(&quot;log&quot;)) {</span>
<span class="nc" id="L416">      return func(Functions.logarithm(sf, pos[0]));</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">    } else if (fnctn[0].equals(&quot;ln&quot;)) {</span>
<span class="nc" id="L418">      return func(Functions.lnat(sf, pos[0]));</span>
<span class="nc bnc" id="L419" title="All 2 branches missed.">    } else if (fnctn[0].equals(&quot;sqrt&quot;)) {</span>
<span class="nc" id="L420">      return func(Functions.sqroot(sf, pos[0]));</span>
    } else {
<span class="nc" id="L422">      return func(Functions.factorial(sf, pos[0]));</span>
    }
  }

  /**
   * replaces the portion of the equation between r and l with the number represented by d
   *
   * @param sb
   * @param l
   * @param r
   * @param d
   * @return String
   */
  private static String replace(String sb, int l, int r, double d) {
<span class="nc bnc" id="L436" title="All 2 branches missed.">    if (r == sb.length() - 1) {</span>
<span class="nc" id="L437">      sb = sb.substring(0, l) + String.valueOf(d);</span>
    } else {
<span class="nc" id="L439">      sb = sb.substring(0, l) + String.valueOf(d) + sb.substring(r, sb.length());</span>
    }
<span class="nc" id="L441">    return sb;</span>
  }

  /**
   * insert the * in all positions of the equation of implicit multiplication
   *
   * @param ins
   * @return String
   */
  private static String insertMultiply(String ins) {
<span class="nc" id="L451">    int q = 0;</span>
    char c1, c2;

<span class="nc bnc" id="L454" title="All 2 branches missed.">    while (q &lt; ins.length() - 1) {</span>
<span class="nc" id="L455">      c1 = ins.charAt(q);</span>
<span class="nc" id="L456">      c2 = ins.charAt(q + 1);</span>

      // account for all combinations of letters and numbers
<span class="nc bnc" id="L459" title="All 8 branches missed.">      if (Character.isDigit(c1) &amp;&amp; (Character.isLetter(c2) || c2 == '(') &amp;&amp; c2 != 'E') {</span>
<span class="nc" id="L460">        ins = ins.substring(0, q + 1) + '*' + ins.substring(q + 1);</span>
<span class="nc bnc" id="L461" title="All 4 branches missed.">      } else if (Character.isDigit(c2) &amp;&amp; c1 == ')') {</span>
<span class="nc" id="L462">        ins = ins.substring(0, q + 1) + '*' + ins.substring(q + 1);</span>
<span class="nc bnc" id="L463" title="All 12 branches missed.">      } else if ((c1 == 'e' || c1 == 'i' || c1 == ')')</span>
<span class="nc bnc" id="L464" title="All 4 branches missed.">          &amp;&amp; (c2 == 'e' || c2 == 'p' || c2 == '(' || Character.isLetter(c2))</span>
          &amp;&amp; c2 != 'n') {
<span class="nc" id="L466">        ins = ins.substring(0, q + 1) + '*' + ins.substring(q + 1);</span>
      }
<span class="nc" id="L468">      q++;</span>
    }
<span class="nc" id="L470">    return ins;</span>
  }

  /**
   * replace all combinations of signs eg. +- changed to -
   *
   * @param str
   * @return String
   */
  private static String resolve(String str) {
    char a, b;
<span class="nc" id="L481">    int k = 0;</span>

<span class="nc bnc" id="L483" title="All 2 branches missed.">    while (k &lt; str.length() - 1) {</span>
<span class="nc" id="L484">      a = str.charAt(k);</span>
<span class="nc" id="L485">      b = str.charAt(k + 1);</span>
<span class="nc bnc" id="L486" title="All 8 branches missed.">      if ((a == '+' || a == '-') &amp;&amp; (b == '+' || b == '-')) {</span>
<span class="nc bnc" id="L487" title="All 8 branches missed.">        if ((a == '+' &amp;&amp; b == '+') || (a == '-' &amp;&amp; b == '-')) {</span>
<span class="nc" id="L488">          str = str.substring(0, k) + '+' + str.substring(k + 2, str.length());</span>
        } else {
<span class="nc" id="L490">          str = str.substring(0, k) + '-' + str.substring(k + 2, str.length());</span>
        }
      }
<span class="nc" id="L493">      k++;</span>
    }
<span class="nc" id="L495">    return str;</span>
  }

  // ************************************************************************************

  /**
   * This class is a helper class to Calc which evaluates the functions that might appear in the
   * equation. The functions replace the function name and arguement and replace it with it's number
   * value. The trigonometric functions can take arguments in either radians or degrees and return
   * either radian or degrees.
   */
  private static class Functions {

    /**
     * calculate the sines in the equation
     *
     * @param ss
     * @param p
     * @param b
     * @return String
     */
    protected static String sine(String ss, int p, boolean b) {
      double theta, result;
<span class="nc" id="L518">      String num = &quot;&quot;;</span>

<span class="nc" id="L520">      num = getNumber(ss, p + 3);</span>
<span class="nc" id="L521">      theta = Double.valueOf(num).doubleValue();</span>
<span class="nc bnc" id="L522" title="All 2 branches missed.">      if (b) {</span>
<span class="nc" id="L523">        result = Math.sin(theta);</span>
      } else {
<span class="nc" id="L525">        result = Math.sin(theta * Math.PI / 180);</span>
      }
<span class="nc" id="L527">      ss =</span>
<span class="nc" id="L528">          ss.substring(0, p)</span>
<span class="nc" id="L529">              + String.valueOf(result)</span>
<span class="nc" id="L530">              + ss.substring(p + 3 + num.length(), ss.length());</span>
<span class="nc" id="L531">      return ss;</span>
    }

    /**
     * calculate the cosines in the equation
     *
     * @param sc
     * @param m
     * @param b
     * @return String
     */
    protected static String cosine(String sc, int m, boolean b) {
      double psi, result;
<span class="nc" id="L544">      String num = &quot;&quot;;</span>

<span class="nc" id="L546">      num = getNumber(sc, m + 3);</span>
<span class="nc" id="L547">      psi = Double.valueOf(num).doubleValue();</span>
<span class="nc bnc" id="L548" title="All 2 branches missed.">      if (b) {</span>
<span class="nc" id="L549">        result = Math.cos(psi);</span>
      } else {
<span class="nc" id="L551">        result = Math.cos(psi * Math.PI / 180);</span>
      }
<span class="nc" id="L553">      sc =</span>
<span class="nc" id="L554">          sc.substring(0, m)</span>
<span class="nc" id="L555">              + String.valueOf(result)</span>
<span class="nc" id="L556">              + sc.substring(m + 3 + num.length(), sc.length());</span>
<span class="nc" id="L557">      return sc;</span>
    }

    /**
     * calculate the tangents in the equation
     *
     * @param st
     * @param n
     * @param b
     * @return String
     */
    protected static String tangent(String st, int n, boolean b) {
      double rho, result;
<span class="nc" id="L570">      String num = &quot;&quot;;</span>

<span class="nc" id="L572">      num = getNumber(st, n + 3);</span>
<span class="nc" id="L573">      rho = Double.valueOf(num).doubleValue();</span>
<span class="nc bnc" id="L574" title="All 2 branches missed.">      if (b) {</span>
<span class="nc" id="L575">        result = Math.tan(rho);</span>
      } else {
<span class="nc" id="L577">        result = Math.tan(rho * Math.PI / 180);</span>
      }
<span class="nc" id="L579">      st =</span>
<span class="nc" id="L580">          st.substring(0, n)</span>
<span class="nc" id="L581">              + String.valueOf(result)</span>
<span class="nc" id="L582">              + st.substring(n + 3 + num.length(), st.length());</span>
<span class="nc" id="L583">      return st;</span>
    }

    /**
     * calculate the inverse sines in the equation
     *
     * @param sa
     * @param a
     * @param q
     * @return String
     */
    protected static String asin(String sa, int a, boolean q) {
      double angle, arg;
      String number;

<span class="nc" id="L598">      number = getNumber(sa, a + 3);</span>
<span class="nc" id="L599">      arg = Double.valueOf(number).doubleValue();</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">      if (q) {</span>
<span class="nc" id="L601">        angle = Math.asin(arg);</span>
      } else {
<span class="nc" id="L603">        angle = Math.asin(arg) * 180 / Math.PI;</span>
      }
<span class="nc" id="L605">      sa =</span>
<span class="nc" id="L606">          sa.substring(0, a - 1)</span>
<span class="nc" id="L607">              + String.valueOf(angle)</span>
<span class="nc" id="L608">              + sa.substring(a + 3 + number.length(), sa.length());</span>
<span class="nc" id="L609">      return sa;</span>
    }

    /**
     * calculate the inverse consines in the equation
     *
     * @param sac
     * @param c
     * @param p
     * @return String
     */
    protected static String acos(String sac, int c, boolean p) {
      double angle, arg;
      String number;

<span class="nc" id="L624">      number = getNumber(sac, c + 3);</span>
<span class="nc" id="L625">      arg = Double.valueOf(number).doubleValue();</span>
<span class="nc bnc" id="L626" title="All 2 branches missed.">      if (p) {</span>
<span class="nc" id="L627">        angle = Math.acos(arg);</span>
      } else {
<span class="nc" id="L629">        angle = Math.acos(arg) * 180 / Math.PI;</span>
      }
<span class="nc" id="L631">      sac =</span>
<span class="nc" id="L632">          sac.substring(0, c - 1)</span>
<span class="nc" id="L633">              + String.valueOf(angle)</span>
<span class="nc" id="L634">              + sac.substring(c + 3 + number.length(), sac.length());</span>
<span class="nc" id="L635">      return sac;</span>
    }

    /**
     * calculate the inverse tangents in the equation
     *
     * @param sat
     * @param b
     * @param z
     * @return String
     */
    protected static String atan(String sat, int b, boolean z) {
      double angle, arg;
      String number;

<span class="nc" id="L650">      number = getNumber(sat, b + 3);</span>
<span class="nc" id="L651">      arg = Double.valueOf(number).doubleValue();</span>
<span class="nc bnc" id="L652" title="All 2 branches missed.">      if (z) {</span>
<span class="nc" id="L653">        angle = Math.atan(arg);</span>
      } else {
<span class="nc" id="L655">        angle = Math.atan(arg) * 180 / Math.PI;</span>
      }
<span class="nc" id="L657">      sat =</span>
<span class="nc" id="L658">          sat.substring(0, b - 1)</span>
<span class="nc" id="L659">              + String.valueOf(angle)</span>
<span class="nc" id="L660">              + sat.substring(b + 3 + number.length(), sat.length());</span>
<span class="nc" id="L661">      return sat;</span>
    }

    /**
     * calculate the logarithms to the base ten in the equation
     *
     * @param sl
     * @param w
     * @return String
     */
    protected static String logarithm(String sl, int w) {
      double arg, result;
<span class="nc" id="L673">      String numl = &quot;&quot;;</span>

<span class="nc" id="L675">      numl = getNumber(sl, w + 3);</span>
<span class="nc" id="L676">      arg = Double.valueOf(numl).doubleValue();</span>
<span class="nc" id="L677">      result = Math.log(arg) / Math.log(10);</span>
<span class="nc" id="L678">      sl =</span>
<span class="nc" id="L679">          sl.substring(0, w)</span>
<span class="nc" id="L680">              + String.valueOf(result)</span>
<span class="nc" id="L681">              + sl.substring(w + 3 + numl.length(), sl.length());</span>
<span class="nc" id="L682">      return sl;</span>
    }

    /**
     * calculate the logarithms to the base e in the equation
     *
     * @param sln
     * @param y
     * @return String
     */
    protected static String lnat(String sln, int y) {
      double real, result;
<span class="nc" id="L694">      String numln = &quot;&quot;;</span>

<span class="nc" id="L696">      numln = getNumber(sln, y + 2);</span>
<span class="nc" id="L697">      real = Double.valueOf(numln).doubleValue();</span>
<span class="nc" id="L698">      result = Math.log(real);</span>
<span class="nc" id="L699">      sln =</span>
<span class="nc" id="L700">          sln.substring(0, y)</span>
<span class="nc" id="L701">              + String.valueOf(result)</span>
<span class="nc" id="L702">              + sln.substring(y + 2 + numln.length(), sln.length());</span>
<span class="nc" id="L703">      return sln;</span>
    }

    /**
     * calculate the square roots in the equation
     *
     * @param sq
     * @param a
     * @return String
     */
    protected static String sqroot(String sq, int a) {
      double arg, result;
<span class="nc" id="L715">      String numsq = &quot;&quot;;</span>

<span class="nc" id="L717">      numsq = getNumber(sq, a + 4);</span>
<span class="nc" id="L718">      arg = Double.valueOf(numsq).doubleValue();</span>
<span class="nc" id="L719">      result = Math.sqrt(arg);</span>
<span class="nc" id="L720">      sq =</span>
<span class="nc" id="L721">          sq.substring(0, a)</span>
<span class="nc" id="L722">              + String.valueOf(result)</span>
<span class="nc" id="L723">              + sq.substring(a + 4 + numsq.length(), sq.length());</span>
<span class="nc" id="L724">      result = Math.sqrt(arg);</span>
<span class="nc" id="L725">      return sq;</span>
    }

    /**
     * get the number that is the arguement to the functions
     *
     * @param sn
     * @param l
     * @return String
     */
    protected static String getNumber(String sn, int l) {
      char cn;
<span class="nc" id="L737">      int index = l;</span>
<span class="nc" id="L738">      String anumber = &quot;&quot;;</span>

<span class="nc" id="L740">      cn = sn.charAt(l);</span>
<span class="nc bnc" id="L741" title="All 8 branches missed.">      while (Character.isDigit(cn) || cn == '.' || (cn == '-' &amp;&amp; index == l)) {</span>
<span class="nc" id="L742">        anumber += cn;</span>

<span class="nc bnc" id="L744" title="All 2 branches missed.">        if (index == sn.length() - 1) {</span>
<span class="nc" id="L745">          break;</span>
        }

<span class="nc" id="L748">        cn = sn.charAt(++index);</span>
      }
<span class="nc" id="L750">      return anumber;</span>
    }

    /**
     * evaluate a factorial that may be in the equation
     *
     * @param sf
     * @param p
     * @return String
     */
    //
    protected static String factorial(String sf, int p) {
      char cf;
<span class="nc" id="L763">      int index = p - 1, arg, right = 0;</span>
<span class="nc" id="L764">      String num = &quot;&quot;;</span>

<span class="nc" id="L766">      cf = sf.charAt(index);</span>
      // test if the factorial is at the beginning of the equation
<span class="nc bnc" id="L768" title="All 2 branches missed.">      while (Character.isDigit(cf)) {</span>
<span class="nc" id="L769">        num = cf + num;</span>
<span class="nc bnc" id="L770" title="All 2 branches missed.">        if (index == 0) {</span>
<span class="nc" id="L771">          right = 0;</span>
<span class="nc" id="L772">          return getFact(Integer.parseInt(num)) + sf.substring(num.length() + 1);</span>
        }
<span class="nc" id="L774">        cf = sf.charAt(--index);</span>
<span class="nc" id="L775">        right = index + 1;</span>
      }
<span class="nc" id="L777">      arg = Integer.parseInt(num);</span>
<span class="nc" id="L778">      sf = sf.substring(0, right) + getFact(arg) + sf.substring(index + num.length() + 2);</span>
<span class="nc" id="L779">      return sf;</span>
    }

    /**
     * use recursion to evaluate a factorial
     *
     * @param a
     * @return double
     */
    protected static double getFact(int a) {

<span class="nc bnc" id="L790" title="All 2 branches missed.">      if (a == 1) {</span>
<span class="nc" id="L791">        return 1;</span>
      } else {
<span class="nc" id="L793">        return a * getFact(a - 1);</span>
      }
    }
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>