<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gui4jSwingContainer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core</a> &gt; <span class="el_source">Gui4jSwingContainer.java</span></div><h1>Gui4jSwingContainer.java</h1><pre class="source lang-java linenums">package org.gui4j.core;

import java.awt.Component;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import org.gui4j.Gui4jCallBase;
import org.gui4j.Gui4jController;
import org.gui4j.Gui4jDispose;
import org.gui4j.event.Gui4jEvent;
import org.gui4j.event.Gui4jEventListener;

/** Stores the Swing instances and the relation between Swing instance and Gui4jComponent */
<span class="nc" id="L16">public abstract class Gui4jSwingContainer {</span>
  private final Gui4jInternal mGui4j;
  private final String mViewResourceName;
  private final String mViewResourceNameFullyQuantified;
  private Gui4jComponentContainer mGui4jComponentContainer;
  private final List mDispose;
  protected boolean inClosing;

  /** Gui4jQualifiedComponent -&gt; Gui4jComponentInstance */
  private final Map mGui4jComponentInstanceMap;

  /** List(Gui4jComponentInstance) */
  private final List mGui4jComponentInstances;

  /** List(Gui4jComponentInstanceProperty) */
  private final List mGui4jComponentInstancePropertyList;

  private Gui4jController mGui4jController;

  /** Class -&gt; (Object -&gt; Object) */
  private final Map mStorageMap;

  private final List mDeleteListeners;

  private final boolean mReadOnlyMode;

  private final Map mGui4jCallBaseMap; // List(Gui4jComponentContainerInclude)

  // -&gt; Gui4jCallBase

  /** String(QualifiedPath) -&gt; Gui4jComponentContainerIncludeInstance */
  private final Map mGui4jComponentContainerIncludeInstanceMap;

  public Gui4jSwingContainer(
      Gui4jInternal gui4j,
      String viewResourceName,
      Gui4jController gui4jController,
<span class="nc" id="L53">      boolean readOnlyMode) {</span>
<span class="nc" id="L54">    mGui4j = gui4j;</span>
<span class="nc" id="L55">    mReadOnlyMode = readOnlyMode;</span>
<span class="nc" id="L56">    mViewResourceName = viewResourceName;</span>
<span class="nc" id="L57">    mDispose = new ArrayList();</span>
<span class="nc" id="L58">    mGui4jController = gui4jController;</span>
<span class="nc" id="L59">    Class c = gui4jController.getClass();</span>
<span class="nc" id="L60">    mViewResourceNameFullyQuantified =</span>
<span class="nc" id="L61">        Gui4jComponentContainerManager.getResourceNameFullyQuantified(</span>
<span class="nc" id="L62">            Gui4jComponentContainerManager.getBaseName(c), mViewResourceName);</span>
<span class="nc" id="L63">    mGui4jComponentInstanceMap = new HashMap();</span>
<span class="nc" id="L64">    mGui4jComponentInstances = new ArrayList();</span>
<span class="nc" id="L65">    mGui4jComponentInstancePropertyList = new ArrayList();</span>
<span class="nc" id="L66">    mGui4jCallBaseMap = new HashMap();</span>
<span class="nc" id="L67">    mStorageMap = new HashMap();</span>
<span class="nc" id="L68">    mDeleteListeners = new ArrayList();</span>
<span class="nc" id="L69">    mGui4jComponentContainerIncludeInstanceMap = new HashMap();</span>
    try {
<span class="nc" id="L71">      mGui4jComponentContainer =</span>
          gui4j
<span class="nc" id="L73">              .getGui4jComponentContainerManager()</span>
<span class="nc" id="L74">              .getGui4jComponentContainer(c, mViewResourceNameFullyQuantified);</span>
<span class="nc" id="L75">    } catch (Throwable e) {</span>
<span class="nc" id="L76">      getGui4j().handleException(gui4jController, e, null);</span>
<span class="nc" id="L77">    }</span>
<span class="nc" id="L78">  }</span>

  public boolean isInClosing() {
<span class="nc" id="L81">    return inClosing;</span>
  }

  public abstract void setBusy(boolean busy);

  private Map getClassStorage(Class clazz) {
<span class="nc" id="L87">    Map classStorage = (Map) mStorageMap.get(clazz);</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">    if (classStorage == null) {</span>
<span class="nc" id="L89">      classStorage = new HashMap();</span>
<span class="nc" id="L90">      mStorageMap.put(clazz, classStorage);</span>
    }
<span class="nc" id="L92">    return classStorage;</span>
  }

  /**
   * Method getGui4jComponentContainerIncludeInstance.
   *
   * @param aliasPath List(Gui4jComponentContainerInclude)
   * @param completePath
   * @param depth
   * @return Gui4jComponentContainerIncludeInstance
   */
  public Gui4jComponentContainerIncludeInstance getGui4jComponentContainerIncludeInstance(
      String aliasPath, Gui4jComponentPath completePath, int depth) {
<span class="nc bnc" id="L105" title="All 2 branches missed.">    assert aliasPath != null;</span>
<span class="nc" id="L106">    Gui4jComponentContainerIncludeInstance gui4jComponentContainerInstance =</span>
        (Gui4jComponentContainerIncludeInstance)
<span class="nc" id="L108">            mGui4jComponentContainerIncludeInstanceMap.get(aliasPath);</span>
<span class="nc bnc" id="L109" title="All 2 branches missed.">    if (gui4jComponentContainerInstance == null) {</span>
<span class="nc" id="L110">      List l = new ArrayList();</span>
<span class="nc" id="L111">      completePath.collectInclude(l);</span>
<span class="nc" id="L112">      List lParent = l.subList(0, depth - 1);</span>
<span class="nc" id="L113">      l = l.subList(0, depth);</span>
<span class="nc bnc" id="L114" title="All 2 branches missed.">      assert l.size() == depth;</span>
<span class="nc" id="L115">      Gui4jComponentPath path = Gui4jComponentPath.getInstance(l);</span>
<span class="nc" id="L116">      Gui4jComponentPath pathParent = Gui4jComponentPath.getInstance(lParent);</span>
<span class="nc" id="L117">      gui4jComponentContainerInstance =</span>
<span class="nc" id="L118">          new Gui4jComponentContainerIncludeInstance(getGui4jCallBase(pathParent), path);</span>
<span class="nc" id="L119">      mGui4jComponentContainerIncludeInstanceMap.put(aliasPath, gui4jComponentContainerInstance);</span>
    }
<span class="nc" id="L121">    return gui4jComponentContainerInstance;</span>
  }

  public boolean inReadOnlyMode() {
<span class="nc" id="L125">    return mReadOnlyMode;</span>
  }

  public boolean isDefined(String id) {
<span class="nc" id="L129">    return mGui4jComponentContainer.isDefined(id);</span>
  }

  public String getToplevelAttrValue(String field) {
<span class="nc" id="L133">    return mGui4jComponentContainer.getToplevelAttrValue(field);</span>
  }

  public Gui4jCall getTitleCall() {
<span class="nc" id="L137">    return mGui4jComponentContainer.getTitleCall();</span>
  }

  public Gui4jCall getWindowNameCall() {
<span class="nc" id="L141">    return mGui4jComponentContainer.getWindowNameCall();</span>
  }

  public Object getStorage(Class clazz, Object key) {
<span class="nc" id="L145">    return getClassStorage(clazz).get(key);</span>
  }

  public void putStorage(Class clazz, Object key, Object value) {
<span class="nc" id="L149">    getClassStorage(clazz).put(key, value);</span>
<span class="nc" id="L150">  }</span>

  public Gui4jController getGui4jController() {
<span class="nc" id="L153">    return mGui4jController;</span>
  }

  /**
   * Method getGui4jCallBase.
   *
   * @param path List(Gui4jComponentContainerInclude)
   * @return Gui4jCallBase
   */
  private Gui4jCallBase getGui4jCallBase(Gui4jComponentPath path) {
<span class="nc" id="L163">    Gui4jCallBase base = (Gui4jCallBase) mGui4jCallBaseMap.get(path);</span>
<span class="nc bnc" id="L164" title="All 2 branches missed.">    if (base != null) {</span>
<span class="nc" id="L165">      return base;</span>
    }
<span class="nc" id="L167">    base = getGui4jController();</span>
<span class="nc bnc" id="L168" title="All 4 branches missed.">    while (path != null &amp;&amp; path.getInclude() != null) {</span>
<span class="nc" id="L169">      Gui4jComponentContainerInclude gui4jComponentContainerInclude = path.getInclude();</span>
<span class="nc" id="L170">      Gui4jCall call = gui4jComponentContainerInclude.getGui4jBaseController();</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">      if (call != null) {</span>
<span class="nc" id="L172">        base = (Gui4jCallBase) call.getValueUseDefaultParam(base, base, null);</span>
      }
<span class="nc" id="L174">      path = path.getSon();</span>
<span class="nc" id="L175">    }</span>
<span class="nc" id="L176">    mGui4jCallBaseMap.put(path, base);</span>
<span class="nc" id="L177">    return base;</span>
  }

  public Gui4jCallBase getGui4jCallBase(Gui4jQualifiedComponent gui4jComponentInPath) {
<span class="nc" id="L181">    return getGui4jCallBase(gui4jComponentInPath.getGui4jComponentPath());</span>
  }

  public Gui4jComponentInstance getGui4jComponentInstance(
      Gui4jComponentPath context, Gui4jQualifiedComponent path) {
<span class="nc" id="L186">    return getGui4jComponentInstance(new Gui4jQualifiedComponent(context, path));</span>
  }

  public Gui4jComponentInstance getGui4jComponentInstance(
      Gui4jQualifiedComponent gui4jComponentInPath) {
<span class="nc" id="L191">    Gui4jComponentInstance gui4jComponentInstance =</span>
<span class="nc" id="L192">        (Gui4jComponentInstance) mGui4jComponentInstanceMap.get(gui4jComponentInPath);</span>
<span class="nc bnc" id="L193" title="All 2 branches missed.">    if (gui4jComponentInstance != null) {</span>
<span class="nc" id="L194">      return gui4jComponentInstance;</span>
    } else {
<span class="nc bnc" id="L196" title="All 2 branches missed.">      if (gui4jComponentInPath.getGui4jComponent() instanceof Gui4jComponentArg) {</span>
<span class="nc" id="L197">        Gui4jQualifiedComponent qualifiedComponent =</span>
            (Gui4jQualifiedComponent)
<span class="nc" id="L199">                mGui4jComponentContainer.getParamInstantiation().get(gui4jComponentInPath);</span>
<span class="nc bnc" id="L200" title="All 2 branches missed.">        assert qualifiedComponent != null;</span>
<span class="nc" id="L201">        gui4jComponentInstance =</span>
            qualifiedComponent
<span class="nc" id="L203">                .getGui4jComponent()</span>
<span class="nc" id="L204">                .createGui4jComponentInstance(</span>
<span class="nc" id="L205">                    this, getGui4jCallBase(qualifiedComponent), qualifiedComponent);</span>
<span class="nc" id="L206">        addGui4jComponentInstance(gui4jComponentInstance);</span>
<span class="nc" id="L207">        return gui4jComponentInstance;</span>
      } else {
<span class="nc" id="L209">        gui4jComponentInstance =</span>
            gui4jComponentInPath
<span class="nc" id="L211">                .getGui4jComponent()</span>
<span class="nc" id="L212">                .createGui4jComponentInstance(</span>
<span class="nc" id="L213">                    this, getGui4jCallBase(gui4jComponentInPath), gui4jComponentInPath);</span>
<span class="nc" id="L214">        addGui4jComponentInstance(gui4jComponentInstance);</span>
<span class="nc" id="L215">        return gui4jComponentInstance;</span>
      }
    }
  }

  private void addGui4jComponentInstance(Gui4jComponentInstance gui4jComponentInstance) {
<span class="nc" id="L221">    Gui4jQualifiedComponent gui4jComponentInPath = gui4jComponentInstance.getGui4jComponentInPath();</span>
<span class="nc bnc" id="L222" title="All 2 branches missed.">    assert gui4jComponentInPath != null;</span>
<span class="nc" id="L223">    List gui4jComponentContainerInstances = new ArrayList();</span>
<span class="nc" id="L224">    Gui4jComponentPath completePath = gui4jComponentInPath.getGui4jComponentPath();</span>
<span class="nc" id="L225">    Gui4jComponentPath path = completePath;</span>
<span class="nc" id="L226">    String aliasPath = &quot;&quot;;</span>
<span class="nc" id="L227">    int depth = 0;</span>
<span class="nc bnc" id="L228" title="All 4 branches missed.">    while (path != null &amp;&amp; path.getInclude() != null) {</span>
<span class="nc" id="L229">      depth++;</span>
<span class="nc" id="L230">      aliasPath = aliasPath + &quot;/&quot; + path.getInclude().getAliasName();</span>
<span class="nc" id="L231">      Gui4jComponentContainerIncludeInstance gui4jComponentContainerInstance =</span>
<span class="nc" id="L232">          getGui4jComponentContainerIncludeInstance(aliasPath, completePath, depth);</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">      if (gui4jComponentContainerInstance.mGui4jComponentContainerInclude.getRefresh() != null) {</span>
<span class="nc" id="L234">        gui4jComponentContainerInstances.add(gui4jComponentContainerInstance);</span>
<span class="nc" id="L235">        gui4jComponentContainerInstance.add(gui4jComponentInstance);</span>
      }
<span class="nc" id="L237">      path = path.getSon();</span>
<span class="nc" id="L238">    }</span>
<span class="nc bnc" id="L239" title="All 2 branches missed.">    if (gui4jComponentInPath.hasId()) {</span>
<span class="nc" id="L240">      mGui4jComponentInstanceMap.put(gui4jComponentInPath, gui4jComponentInstance);</span>
    }
<span class="nc" id="L242">    mGui4jComponentInstances.add(gui4jComponentInstance);</span>
<span class="nc" id="L243">    Gui4jComponent gui4jComponent = gui4jComponentInstance.getGui4jComponent();</span>
<span class="nc" id="L244">    Gui4jComponentProperty[] gui4jComponentProperties =</span>
<span class="nc" id="L245">        gui4jComponent.getGui4jComponentProperties();</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">    if (gui4jComponentProperties != null) {</span>
<span class="nc bnc" id="L247" title="All 2 branches missed.">      for (int i = 0; i &lt; gui4jComponentProperties.length; i++) {</span>
<span class="nc" id="L248">        Gui4jComponentProperty gui4jComponentProperty = gui4jComponentProperties[i];</span>
<span class="nc bnc" id="L249" title="All 2 branches missed.">        if (gui4jComponentProperty.getGui4jAccess().hasTriggerEvents()) {</span>
<span class="nc" id="L250">          Gui4jComponentInstanceProperty gui4jComponentInstanceProperty =</span>
              new Gui4jComponentInstanceProperty(gui4jComponentInstance, gui4jComponentProperty);
<span class="nc" id="L252">          mGui4jComponentInstancePropertyList.add(gui4jComponentInstanceProperty);</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">          for (Iterator it = gui4jComponentContainerInstances.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L254">            Gui4jComponentContainerIncludeInstance gui4jComponentContainerInstance =</span>
<span class="nc" id="L255">                (Gui4jComponentContainerIncludeInstance) it.next();</span>
<span class="nc" id="L256">            gui4jComponentContainerInstance.add(gui4jComponentInstanceProperty);</span>
<span class="nc" id="L257">          }</span>
        }
      }
    }
<span class="nc" id="L261">  }</span>

  public Gui4jComponentInstance getGui4jComponentInstance(String id) {
<span class="nc" id="L264">    Gui4jQualifiedComponent gui4jComponentInPath =</span>
<span class="nc" id="L265">        mGui4jComponentContainer.getGui4jQualifiedComponent(id);</span>
<span class="nc" id="L266">    return getGui4jComponentInstance(gui4jComponentInPath);</span>
  }

  /**
   * Returns the JComponent instance for the given id. If there is no component for that id, a new
   * instance is created.
   *
   * @param id
   * @return Component
   */
  protected Component getComponent(String id) {
<span class="nc" id="L277">    Gui4jComponentInstance gui4jComponentInstance = getGui4jComponentInstance(id);</span>
<span class="nc" id="L278">    return gui4jComponentInstance.getComponent();</span>
  }

  public void addDispose(Gui4jDispose clearListener) {
<span class="nc" id="L282">    mDispose.add(clearListener);</span>
<span class="nc" id="L283">  }</span>

  public synchronized void dispose() {
<span class="nc bnc" id="L286" title="All 2 branches missed.">    for (Iterator it = mDispose.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L287">      Gui4jDispose disposeElement = (Gui4jDispose) it.next();</span>
<span class="nc" id="L288">      disposeElement.dispose();</span>
<span class="nc" id="L289">    }</span>
<span class="nc" id="L290">    mDispose.clear();</span>
<span class="nc bnc" id="L291" title="All 2 branches missed.">    for (Iterator it = mDeleteListeners.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L292">      Gui4jPropertyListenerDelete elem = (Gui4jPropertyListenerDelete) it.next();</span>
<span class="nc" id="L293">      elem.removeListener();</span>
<span class="nc" id="L294">    }</span>
<span class="nc" id="L295">    mDeleteListeners.clear();</span>
<span class="nc" id="L296">    mGui4jCallBaseMap.clear();</span>

<span class="nc" id="L298">    mGui4jComponentContainerIncludeInstanceMap.clear();</span>
<span class="nc" id="L299">    for (Iterator it = mGui4jComponentContainerIncludeInstanceMap.values().iterator();</span>
<span class="nc bnc" id="L300" title="All 2 branches missed.">        it.hasNext(); ) {</span>
<span class="nc" id="L301">      Gui4jComponentContainerIncludeInstance instance =</span>
<span class="nc" id="L302">          (Gui4jComponentContainerIncludeInstance) it.next();</span>
<span class="nc" id="L303">      instance.dispose();</span>
<span class="nc" id="L304">    }</span>
<span class="nc" id="L305">    mGui4jComponentInstanceMap.clear();</span>

<span class="nc bnc" id="L307" title="All 2 branches missed.">    for (Iterator it = mGui4jComponentInstances.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L308">      Gui4jComponentInstance gui4jComponentInstance = (Gui4jComponentInstance) it.next();</span>
<span class="nc" id="L309">      gui4jComponentInstance.dispose();</span>
<span class="nc" id="L310">    }</span>
<span class="nc" id="L311">    mGui4jComponentInstances.clear();</span>
<span class="nc bnc" id="L312" title="All 2 branches missed.">    for (Iterator it = mGui4jComponentInstancePropertyList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L313">      Gui4jComponentInstanceProperty gui4jComponentInstanceProperty =</span>
<span class="nc" id="L314">          (Gui4jComponentInstanceProperty) it.next();</span>
<span class="nc" id="L315">      gui4jComponentInstanceProperty.dispose();</span>
<span class="nc" id="L316">    }</span>
<span class="nc" id="L317">    mGui4jComponentInstancePropertyList.clear();</span>
<span class="nc" id="L318">    mStorageMap.clear();</span>
<span class="nc" id="L319">  }</span>

  public void cleanUp() {
<span class="nc" id="L322">    mGui4jController = null;</span>
<span class="nc" id="L323">  }</span>

  public Gui4jInternal getGui4j() {
<span class="nc" id="L326">    return mGui4j;</span>
  }

  public void registerForDeleteListenerOnGui4jProperty(
      Gui4jEvent gui4jProperty, Gui4jEventListener gui4jPropertyListener) {
<span class="nc" id="L331">    Gui4jPropertyListenerDelete gui4jPropertyListenerDelete =</span>
        new Gui4jPropertyListenerDelete(gui4jProperty, gui4jPropertyListener);
<span class="nc" id="L333">    mDeleteListeners.add(gui4jPropertyListenerDelete);</span>
<span class="nc" id="L334">  }</span>

  /**
   * Erzwing alle Komponenten ihre Attribute neu auszuwerten. Ist gedacht um die GUI zu
   * aktualisieren. Im Moment sehr einfach implementiert. Kann sein, dass diese Implementierung
   * nicht ausreicht und etwa eine refresh-Methode bei den einzelnen Komponenten aufgerufen werden
   * muss.
   */
  public synchronized void refreshAll() {
<span class="nc" id="L343">    Gui4jThreadManager.executeInSwingThreadAndContinue(</span>
<span class="nc" id="L344">        new Runnable() {</span>
          public void run() {
<span class="nc bnc" id="L346" title="All 2 branches missed.">            for (Iterator it = mGui4jComponentInstances.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L347">              Gui4jComponentInstance gui4jComponentInstance = (Gui4jComponentInstance) it.next();</span>
<span class="nc" id="L348">              gui4jComponentInstance.getGui4jComponent().refreshComponent(gui4jComponentInstance);</span>
<span class="nc" id="L349">            }</span>
            /*
             * folgender Code scheint nicht notwendig zu sein for (Iterator
             * it = mGui4jComponentInstancePropertyList.iterator();
             * it.hasNext();) { Gui4jComponentInstanceProperty property =
             * (Gui4jComponentInstanceProperty) it.next();
             * property.eventOccured(); }
             */
<span class="nc" id="L357">          }</span>
        });
<span class="nc" id="L359">  }</span>

  private static class Gui4jPropertyListenerDelete {
    private final Gui4jEvent mGui4jProperty;
    private final Gui4jEventListener mGui4jPropertyListener;

    Gui4jPropertyListenerDelete(
<span class="nc" id="L366">        Gui4jEvent gui4jProperty, Gui4jEventListener gui4jPropertyListener) {</span>
<span class="nc" id="L367">      mGui4jProperty = gui4jProperty;</span>
<span class="nc" id="L368">      mGui4jPropertyListener = gui4jPropertyListener;</span>
<span class="nc" id="L369">    }</span>

    void removeListener() {
<span class="nc" id="L372">      mGui4jProperty.removeEventListener(mGui4jPropertyListener);</span>
<span class="nc" id="L373">    }</span>
  }

  private static class Gui4jComponentInstanceProperty implements Gui4jEventListener {
    private final Gui4jComponentInstance mGui4jComponentInstance;
    private final Gui4jComponentProperty mGui4jComponentProperty;
    private final Gui4jCallBase mGui4jController;
    private final List mRegisteredProperties;

    Gui4jComponentInstanceProperty(
        Gui4jComponentInstance gui4jComponentInstance,
<span class="nc" id="L384">        Gui4jComponentProperty gui4jComponentProperty) {</span>
<span class="nc" id="L385">      mGui4jComponentInstance = gui4jComponentInstance;</span>
<span class="nc" id="L386">      mGui4jComponentProperty = gui4jComponentProperty;</span>
<span class="nc" id="L387">      mGui4jController = gui4jComponentInstance.getGui4jCallBase();</span>
<span class="nc" id="L388">      mRegisteredProperties = new ArrayList();</span>
<span class="nc" id="L389">      Gui4jCall gui4jAccess = mGui4jComponentProperty.getGui4jAccess();</span>
<span class="nc" id="L390">      Gui4jCall[] dependantProperties = gui4jAccess.getDependantProperties();</span>
<span class="nc bnc" id="L391" title="All 2 branches missed.">      if (dependantProperties != null) {</span>
<span class="nc bnc" id="L392" title="All 2 branches missed.">        for (int i = 0; i &lt; dependantProperties.length; i++) {</span>
<span class="nc" id="L393">          Gui4jEvent gui4jProperty =</span>
<span class="nc" id="L394">              (Gui4jEvent) dependantProperties[i].getValueNoParams(mGui4jController, null);</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">          if (gui4jProperty != null) {</span>
<span class="nc" id="L396">            gui4jProperty.addEventListener(this);</span>
<span class="nc" id="L397">            mRegisteredProperties.add(gui4jProperty);</span>
          }
        }
      }
<span class="nc" id="L401">    }</span>

    public void dispose() {
<span class="nc bnc" id="L404" title="All 2 branches missed.">      for (Iterator it = mRegisteredProperties.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L405">        Gui4jEvent gui4jProperty = (Gui4jEvent) it.next();</span>
<span class="nc" id="L406">        gui4jProperty.removeEventListener(this);</span>
<span class="nc" id="L407">      }</span>
<span class="nc" id="L408">      mRegisteredProperties.clear();</span>
<span class="nc" id="L409">    }</span>

    public void eventOccured() {
<span class="nc" id="L412">      mGui4jComponentProperty.apply(mGui4jComponentInstance, mGui4jController, true);</span>
<span class="nc" id="L413">    }</span>
  }

  // *****************************************************************************

  /** Instanzen von dieser Klasse sind einem Include-Pfad (ausgehend von der Wurzel) zugeordnet. */
<span class="nc" id="L419">  private static final class Gui4jComponentContainerIncludeInstance implements Gui4jEventListener {</span>
    protected final Gui4jComponentContainerInclude mGui4jComponentContainerInclude;
    private final List mPropertyList;
    private final List mGui4jComponentInstanceList;
    private final List mEventList; // List(Event)

    /**
     * Method Gui4jComponentContainerIncludeInstance.
     *
     * @param gui4jCallBase
     * @param path List(Gui4jComponentContainerInclude)
     */
    public Gui4jComponentContainerIncludeInstance(
<span class="nc" id="L432">        Gui4jCallBase gui4jCallBase, Gui4jComponentPath path) {</span>
<span class="nc bnc" id="L433" title="All 4 branches missed.">      assert path != null &amp;&amp; path.getInclude() != null;</span>
<span class="nc" id="L434">      Gui4jComponentContainerInclude gui4jComponentContainerInclude = null;</span>
<span class="nc bnc" id="L435" title="All 4 branches missed.">      while (path != null &amp;&amp; path.getInclude() != null) {</span>
<span class="nc" id="L436">        gui4jComponentContainerInclude = path.getInclude();</span>
<span class="nc" id="L437">        path = path.getSon();</span>
      }
<span class="nc" id="L439">      Gui4jCall[] refresh = gui4jComponentContainerInclude.getRefresh();</span>
<span class="nc" id="L440">      mGui4jComponentContainerInclude = gui4jComponentContainerInclude;</span>
<span class="nc" id="L441">      mPropertyList = new ArrayList();</span>
<span class="nc" id="L442">      mGui4jComponentInstanceList = new ArrayList();</span>
<span class="nc" id="L443">      mEventList = new ArrayList();</span>
      // f√ºllen
<span class="nc bnc" id="L445" title="All 2 branches missed.">      if (refresh != null) {</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">        for (int i = 0; i &lt; refresh.length; i++) {</span>
<span class="nc" id="L447">          Gui4jEvent gui4jProperty = (Gui4jEvent) refresh[i].getValueNoParams(gui4jCallBase, null);</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">          if (gui4jProperty != null) {</span>
<span class="nc" id="L449">            mEventList.add(gui4jProperty);</span>
          }
        }
<span class="nc bnc" id="L452" title="All 2 branches missed.">        for (Iterator it = mEventList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L453">          Gui4jEvent event = (Gui4jEvent) it.next();</span>
<span class="nc" id="L454">          event.addEventListener(this);</span>
<span class="nc" id="L455">        }</span>
      }
<span class="nc" id="L457">    }</span>

    public void dispose() {
<span class="nc bnc" id="L460" title="All 2 branches missed.">      for (Iterator it = mEventList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L461">        Gui4jEvent event = (Gui4jEvent) it.next();</span>
<span class="nc" id="L462">        event.removeEventListener(this);</span>
<span class="nc" id="L463">      }</span>
<span class="nc" id="L464">      mEventList.clear();</span>
<span class="nc" id="L465">      mPropertyList.clear();</span>
<span class="nc" id="L466">      mGui4jComponentInstanceList.clear();</span>
<span class="nc" id="L467">    }</span>

    public void add(Gui4jComponentInstance gui4jComponentInstance) {
<span class="nc" id="L470">      mGui4jComponentInstanceList.add(gui4jComponentInstance);</span>
<span class="nc" id="L471">    }</span>

    public void add(Gui4jComponentInstanceProperty property) {
      // sofern im Refresh die Property nicht gebraucht wird, brauchen
      // wir uns sie auch nicht merken.
<span class="nc" id="L476">    }</span>

<span class="nc" id="L478">    public void refresh() {}</span>

    public void eventOccured() {
<span class="nc bnc" id="L481" title="All 2 branches missed.">      for (Iterator it = mGui4jComponentInstanceList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L482">        Gui4jComponentInstance gui4jComponentInstance = (Gui4jComponentInstance) it.next();</span>
<span class="nc" id="L483">        gui4jComponentInstance.getGui4jComponent().refreshComponent(gui4jComponentInstance);</span>
<span class="nc" id="L484">      }</span>

      /*
       * // Kein Refresh der Properties for (Iterator it =
       * mPropertyList.iterator(); it.hasNext();) {
       * Gui4jComponentInstanceProperty property =
       * (Gui4jComponentInstanceProperty) it.next();
       * property.eventOccured(); }
       */
<span class="nc" id="L493">    }</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>