<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gui4jStyleContainer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core</a> &gt; <span class="el_source">Gui4jStyleContainer.java</span></div><h1>Gui4jStyleContainer.java</h1><pre class="source lang-java linenums">package org.gui4j.core;

import java.io.Serializable;
import java.util.HashMap;
import java.util.HashSet;
import java.util.Iterator;
import java.util.List;
import java.util.Map;
import java.util.Set;
import org.dom4j.Attribute;
import org.dom4j.LElement;
import org.gui4j.exception.ErrorTags;
import org.gui4j.exception.Gui4jUncheckedException;

public final class Gui4jStyleContainer implements Serializable, ErrorTags {
  private static final long serialVersionUID = 1L;
  private final Map&lt;String, Map&lt;String, Map&lt;String, String&gt;&gt;&gt; mStyleMap;
  private final Map&lt;String, String&gt; mStyleMapResourceName;
  private final String mConfigurationName;
<span class="nc" id="L20">  private final String NOTHING = &quot;Nothing&quot;;</span>
<span class="nc" id="L21">  private final String DEFAULT = &quot;Default&quot;;</span>

<span class="nc" id="L23">  public Gui4jStyleContainer(String configurationName) {</span>
<span class="nc" id="L24">    mStyleMap = new HashMap&lt;String, Map&lt;String, Map&lt;String, String&gt;&gt;&gt;();</span>
<span class="nc" id="L25">    mStyleMapResourceName = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L26">    mConfigurationName = configurationName;</span>
<span class="nc" id="L27">  }</span>

  /**
   * @param resourceName
   * @param styleName name of style
   * @param styleExtends name of style to be extended
   */
  public void createStyle(String resourceName, String styleName, String styleExtends) {
<span class="nc" id="L35">    Map&lt;String, Map&lt;String, String&gt;&gt; style = getStyle(styleName, false);</span>
<span class="nc bnc" id="L36" title="All 4 branches missed.">    if (style != null &amp;&amp; !resourceName.equals(mStyleMapResourceName.get(styleName))) {</span>
<span class="nc" id="L37">      Object[] args = {styleName};</span>
<span class="nc" id="L38">      throw new Gui4jUncheckedException.ResourceError(</span>
          mConfigurationName, -1, RESOURCE_ERROR_style_defined_twice, args);
    }

<span class="nc" id="L42">    style = new HashMap&lt;String, Map&lt;String, String&gt;&gt;();</span>
<span class="nc" id="L43">    mStyleMap.put(styleName, style);</span>
<span class="nc" id="L44">    mStyleMapResourceName.put(styleName, resourceName);</span>

<span class="nc bnc" id="L46" title="All 2 branches missed.">    if (styleExtends != null) {</span>
<span class="nc" id="L47">      Map&lt;String, Map&lt;String, String&gt;&gt; styleE = getStyle(styleExtends, true);</span>
<span class="nc" id="L48">      for (Iterator&lt;Map.Entry&lt;String, Map&lt;String, String&gt;&gt;&gt; it = styleE.entrySet().iterator();</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">          it.hasNext(); ) {</span>
<span class="nc" id="L50">        Map.Entry&lt;String, Map&lt;String, String&gt;&gt; entry = it.next();</span>
<span class="nc" id="L51">        String elementName = entry.getKey();</span>
<span class="nc" id="L52">        Map&lt;String, String&gt; attributes = entry.getValue();</span>
<span class="nc" id="L53">        style.put(elementName, attributes);</span>
<span class="nc" id="L54">      }</span>
    }
<span class="nc" id="L56">  }</span>

  private Map&lt;String, Map&lt;String, String&gt;&gt; getStyle(String styleName, boolean checkExistent) {
<span class="nc" id="L59">    Map&lt;String, Map&lt;String, String&gt;&gt; style = mStyleMap.get(styleName);</span>
<span class="nc bnc" id="L60" title="All 4 branches missed.">    if (checkExistent &amp;&amp; style == null) {</span>
<span class="nc" id="L61">      Object[] args = {styleName};</span>
<span class="nc" id="L62">      throw new Gui4jUncheckedException.ResourceError(</span>
          mConfigurationName, -1, RESOURCE_ERROR_style_not_defined, args);
    }
<span class="nc" id="L65">    return style;</span>
  }

  public void addAttributes(String elementName, String styleName, List&lt;Attribute&gt; attributes) {
<span class="nc" id="L69">    Map&lt;String, Map&lt;String, String&gt;&gt; style = getStyle(styleName, true);</span>
<span class="nc" id="L70">    Map&lt;String, String&gt; attrs = style.get(elementName);</span>
<span class="nc bnc" id="L71" title="All 2 branches missed.">    if (attrs != null) {</span>
<span class="nc" id="L72">      Map&lt;String, String&gt; oldAttrs = attrs;</span>
<span class="nc" id="L73">      attrs = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L74">      style.put(elementName, attrs);</span>
<span class="nc" id="L75">      for (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = oldAttrs.entrySet().iterator();</span>
<span class="nc bnc" id="L76" title="All 2 branches missed.">          it.hasNext(); ) {</span>
<span class="nc" id="L77">        Map.Entry&lt;String, String&gt; entry = it.next();</span>
<span class="nc" id="L78">        String name = entry.getKey();</span>
<span class="nc" id="L79">        String value = entry.getValue();</span>
<span class="nc" id="L80">        attrs.put(name, value);</span>
<span class="nc" id="L81">      }</span>
<span class="nc" id="L82">    } else {</span>
<span class="nc" id="L83">      attrs = new HashMap&lt;String, String&gt;();</span>
<span class="nc" id="L84">      style.put(elementName, attrs);</span>
    }

<span class="nc bnc" id="L87" title="All 2 branches missed.">    for (Iterator&lt;Attribute&gt; it = attributes.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L88">      Attribute attr = it.next();</span>
<span class="nc" id="L89">      attrs.put(attr.getName(), attr.getValue());</span>
<span class="nc" id="L90">    }</span>
<span class="nc" id="L91">  }</span>

  /**
   * Copies all defined styles of &lt;code&gt;gui4jStyleContainer&lt;/code&gt; If such a style is already
   * defined, an exception is thrown.
   *
   * @param gui4jStyleContainer
   */
  public void extendBy(Gui4jStyleContainer gui4jStyleContainer) {
<span class="nc" id="L100">    for (Iterator&lt;Map.Entry&lt;String, Map&lt;String, Map&lt;String, String&gt;&gt;&gt;&gt; it =</span>
<span class="nc" id="L101">            gui4jStyleContainer.mStyleMap.entrySet().iterator();</span>
<span class="nc bnc" id="L102" title="All 2 branches missed.">        it.hasNext(); ) {</span>
<span class="nc" id="L103">      Map.Entry&lt;String, Map&lt;String, Map&lt;String, String&gt;&gt;&gt; entry = it.next();</span>
<span class="nc" id="L104">      String styleName = entry.getKey();</span>
<span class="nc" id="L105">      Map&lt;String, Map&lt;String, String&gt;&gt; style = entry.getValue();</span>

<span class="nc" id="L107">      Map&lt;String, Map&lt;String, String&gt;&gt; thisStyle = getStyle(styleName, false);</span>

<span class="nc bnc" id="L109" title="All 2 branches missed.">      if (thisStyle != null</span>
          &amp;&amp; !mStyleMapResourceName
<span class="nc" id="L111">              .get(styleName)</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">              .equals(gui4jStyleContainer.mStyleMapResourceName.get(styleName))) {</span>
<span class="nc" id="L113">        Object[] args = {styleName};</span>
<span class="nc" id="L114">        throw new Gui4jUncheckedException.ResourceError(</span>
            mConfigurationName, -1, RESOURCE_ERROR_style_defined_twice, args);
      }

<span class="nc" id="L118">      mStyleMap.put(styleName, style);</span>
<span class="nc" id="L119">      mStyleMapResourceName.put(</span>
<span class="nc" id="L120">          styleName, gui4jStyleContainer.mStyleMapResourceName.get(styleName));</span>
<span class="nc" id="L121">    }</span>
<span class="nc" id="L122">  }</span>

  /**
   * Element &lt;code&gt;e&lt;/code&gt; represents a &lt;code&gt;Gui4jComponent&lt;/code&gt;. The method inserts all
   * attributes in that instance defined by this style which are not defined by the element
   *
   * @param e
   */
  public void extend(LElement e) {
<span class="nc" id="L131">    String styleName = e.attributeValue(Gui4jComponentFactory.FIELD_Style);</span>
<span class="nc bnc" id="L132" title="All 4 branches missed.">    if (styleName != null &amp;&amp; styleName.equals(NOTHING)) {</span>
<span class="nc" id="L133">      return;</span>
    }
<span class="nc" id="L135">    String name = e.getName();</span>
<span class="nc" id="L136">    Map&lt;String, String&gt; attrs = null;</span>
<span class="nc bnc" id="L137" title="All 2 branches missed.">    if (styleName != null) {</span>
<span class="nc" id="L138">      Map&lt;String, Map&lt;String, String&gt;&gt; style = getStyle(styleName, true);</span>
<span class="nc" id="L139">      attrs = style.get(name);</span>
<span class="nc bnc" id="L140" title="All 2 branches missed.">      if (attrs == null) {</span>
        // maybe we should not throw an exception
        // there is no problem if there are no attributes for this element

        /*
        throw new UncheckedGui4jException(
        	mConfigurationSource.toString()
        		+ &quot;: style with name &quot;
        		+ styleName
        		+ &quot; for element &quot;
        		+ name
        		+ &quot; not defined&quot;);
        */
      }
<span class="nc" id="L154">    } else {</span>
<span class="nc" id="L155">      Map&lt;String, Map&lt;String, String&gt;&gt; style = getStyle(DEFAULT, false);</span>
<span class="nc bnc" id="L156" title="All 2 branches missed.">      if (style != null) {</span>
<span class="nc" id="L157">        attrs = style.get(name);</span>
      }
    }
<span class="nc bnc" id="L160" title="All 2 branches missed.">    if (attrs != null) {</span>
<span class="nc" id="L161">      Set&lt;String&gt; names = new HashSet&lt;String&gt;();</span>
<span class="nc" id="L162">      List&lt;Attribute&gt; attrList = e.attributes();</span>
<span class="nc bnc" id="L163" title="All 2 branches missed.">      for (Iterator&lt;Attribute&gt; it = attrList.iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L164">        Attribute attr = it.next();</span>
<span class="nc" id="L165">        names.add(attr.getName());</span>
<span class="nc" id="L166">      }</span>

<span class="nc" id="L168">      boolean modified = false;</span>
<span class="nc bnc" id="L169" title="All 2 branches missed.">      for (Iterator&lt;Map.Entry&lt;String, String&gt;&gt; it = attrs.entrySet().iterator(); it.hasNext(); ) {</span>
<span class="nc" id="L170">        Map.Entry&lt;String, String&gt; entry = it.next();</span>
<span class="nc bnc" id="L171" title="All 2 branches missed.">        if (!names.contains(entry.getKey())) {</span>
<span class="nc" id="L172">          e.addAttribute(entry.getKey(), entry.getValue());</span>
          /*
          attrList.add(
          	new Attribute(
          		(String) entry.getKey(),
          		(String) entry.getValue()));
          		*/
<span class="nc" id="L179">          modified = true;</span>
        }
<span class="nc" id="L181">      }</span>

<span class="nc bnc" id="L183" title="All 2 branches missed.">      if (modified) {</span>
        // e.setAttributes(attrList);
      }
    }
<span class="nc" id="L187">    e.addAttribute(Gui4jComponentFactory.FIELD_Style, NOTHING);</span>
<span class="nc" id="L188">  }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>