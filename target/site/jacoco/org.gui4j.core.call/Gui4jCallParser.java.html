<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Gui4jCallParser.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gui4j</a> &gt; <a href="index.source.html" class="el_package">org.gui4j.core.call</a> &gt; <span class="el_source">Gui4jCallParser.java</span></div><h1>Gui4jCallParser.java</h1><pre class="source lang-java linenums">package org.gui4j.core.call;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.List;
import java.util.Map;
import org.gui4j.core.Gui4jCall;
import org.gui4j.core.Gui4jCallFactory;
import org.gui4j.core.Gui4jComponent;
import org.gui4j.core.Gui4jMap1;
import org.gui4j.core.Gui4jTypeCheck;
import org.gui4j.event.Gui4jEvent;
import org.gui4j.exception.ErrorTags;
import org.gui4j.exception.Gui4jUncheckedException;

public final class Gui4jCallParser implements Gui4jCallFactory, ErrorTags, Serializable {
  private static final long serialVersionUID = 1L;

  /** Constructor for Gui4jCallParser. */
  public Gui4jCallParser() {
<span class="fc" id="L21">    super();</span>
<span class="fc" id="L22">  }</span>

  /* (non-Javadoc)
   * @see org.gui4j.core.Gui4jCallFactory#getInstance(org.gui4j.core.Gui4jComponent, int, java.lang.String)
   */
  public Gui4jCall getInstance(Gui4jComponent gui4jComponent, int lineNumber, String accessPath) {
<span class="fc" id="L28">    Map m = null;</span>
<span class="fc" id="L29">    return getInstance(gui4jComponent, lineNumber, m, accessPath);</span>
  }

  /* (non-Javadoc)
   * @see org.gui4j.core.Gui4jCallFactory#getInstance(org.gui4j.core.Gui4jComponent, int, java.lang.Class, java.lang.String)
   */
  public Gui4jCall getInstance(
      Gui4jComponent gui4jComponent, int lineNumber, Class valueClass, String accessPath) {
<span class="nc" id="L37">    Map m = new Gui4jMap1(&quot;&quot;, valueClass);</span>
<span class="nc" id="L38">    return getInstance(gui4jComponent, lineNumber, m, accessPath);</span>
  }

  /* (non-Javadoc)
   * @see org.gui4j.core.Gui4jCallFactory#getInstance(org.gui4j.core.Gui4jComponent, int, java.util.Map, java.lang.String)
   */
  public Gui4jCall getInstance(
      Gui4jComponent gui4jComponent, int lineNumber, Map valueClassMap, String accessPath) {
<span class="fc" id="L46">    Class baseClass = gui4jComponent.getGui4jComponentContainer().getGui4jControllerClass();</span>
<span class="pc bpc" id="L47" title="1 of 2 branches missed.">    if (accessPath == null) {</span>
<span class="nc" id="L48">      return null;</span>
    }

<span class="fc" id="L51">    Gui4jAccessImpl baseAccess = new Gui4jAccessBase(baseClass);</span>

<span class="fc" id="L53">    ParseCtx parseCtx =</span>
        new ParseCtx(this, gui4jComponent, lineNumber, valueClassMap, baseAccess, accessPath);

<span class="fc" id="L56">    List dependantProps = null;</span>
<span class="pc bpc" id="L57" title="2 of 4 branches missed.">    if (accessPath.length() &gt; 0 &amp;&amp; accessPath.charAt(0) == '{') {</span>
<span class="nc" id="L58">      dependantProps = parseDependantProperties(parseCtx, accessPath);</span>
    }

<span class="pc bpc" id="L61" title="1 of 2 branches missed.">    if (parseCtx.i == accessPath.length()) {</span>
<span class="nc" id="L62">      return new Gui4jDefaultCall(gui4jComponent, null, dependantProps, valueClassMap);</span>
    }

    // support for &quot;internal action&quot; calls,
    // e.g. maximization of portlets
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">    if (accessPath.charAt(parseCtx.i) == '!') {</span>
<span class="nc" id="L68">      return new Gui4jInternalActionCall(gui4jComponent, accessPath.substring(parseCtx.i + 1));</span>
    }

<span class="fc" id="L71">    Gui4jAccessImpl result = parseSeqSequence(parseCtx, accessPath);</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">    if (parseCtx.i &lt; accessPath.length()) {</span>
<span class="nc" id="L73">      Object[] args = {accessPath, Integer.valueOf(parseCtx.i)};</span>
<span class="nc" id="L74">      throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L75">          parseCtx.getConfigurationName(),</span>
<span class="nc" id="L76">          parseCtx.getLineNumber(),</span>
          RESOURCE_ERROR_access_unexpected_character,
          args);
    }

<span class="fc" id="L81">    return new Gui4jDefaultCall(</span>
<span class="fc" id="L82">        gui4jComponent, result, dependantProps, valueClassMap, parseCtx.getUsedParams());</span>
  }

  private Gui4jAccessImpl getInstance(
      ParseCtx parseCtx, Gui4jAccessImpl thisAccess, String accessPath) {
<span class="fc" id="L87">    int pos = parseCtx.i;</span>
<span class="fc" id="L88">    int len = accessPath.length();</span>
<span class="pc bpc" id="L89" title="1 of 2 branches missed.">    if (pos &gt;= len) {</span>
<span class="nc" id="L90">      Object[] args = {accessPath, Integer.valueOf(pos)};</span>
<span class="nc" id="L91">      throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L92">          parseCtx.getConfigurationName(),</span>
<span class="nc" id="L93">          parseCtx.getLineNumber(),</span>
          RESOURCE_ERROR_access_unexpected_end,
          args);
    }

<span class="pc bpc" id="L98" title="7 of 10 branches missed.">    switch (accessPath.charAt(pos)) {</span>
      case '\'':
<span class="fc" id="L100">        return new Gui4jAccessConstant(parseCtx, accessPath);</span>
      case '{':
      case '}':
      case ')':
      case ',':
      case '.':
      case ';':
        {
<span class="nc" id="L108">          Object[] args = {accessPath, Integer.valueOf(pos)};</span>
<span class="nc" id="L109">          throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L110">              parseCtx.getConfigurationName(),</span>
<span class="nc" id="L111">              parseCtx.getLineNumber(),</span>
              RESOURCE_ERROR_access_unexpected_end,
              args);
        }
      case '(':
<span class="nc" id="L116">        parseCtx.i = parseCtx.i + 1;</span>
<span class="nc" id="L117">        Gui4jAccessImpl gui4jAccess = getInstance(parseCtx, thisAccess, accessPath);</span>
<span class="nc bnc" id="L118" title="All 4 branches missed.">        if (len &gt;= parseCtx.i || accessPath.charAt(parseCtx.i) != ')') {</span>
<span class="nc" id="L119">          Object[] args = {accessPath, Integer.valueOf(pos)};</span>
<span class="nc" id="L120">          throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L121">              parseCtx.getConfigurationName(),</span>
<span class="nc" id="L122">              parseCtx.getLineNumber(),</span>
              RESOURCE_ERROR_access_unexpected_character,
              args);
        } else {
<span class="nc" id="L126">          parseCtx.i = parseCtx.i + 1; // skip ')'</span>
        }
<span class="nc" id="L128">        return gui4jAccess;</span>
      case ':':
<span class="nc" id="L130">        return new Gui4jAccessStatic(parseCtx, accessPath);</span>
      case '~':
<span class="nc" id="L132">        return new Gui4jAccessBoolean(parseCtx, accessPath);</span>
      case '0':
      case '1':
      case '2':
      case '3':
      case '4':
      case '5':
      case '6':
      case '7':
      case '8':
      case '9':
        {
<span class="fc" id="L144">          boolean isDouble = false;</span>
<span class="fc" id="L145">          int i = pos;</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">          while (i &lt; len) {</span>
<span class="fc" id="L147">            char c = accessPath.charAt(i);</span>
<span class="pc bpc" id="L148" title="1 of 2 branches missed.">            if (c == '.') {</span>
<span class="nc" id="L149">              isDouble = true;</span>
<span class="nc" id="L150">              break;</span>
<span class="pc bpc" id="L151" title="1 of 4 branches missed.">            } else if (c &gt;= '0' &amp;&amp; c &lt;= '9') {</span>
              // go to next character
<span class="fc" id="L153">              i++;</span>
            } else {
              break;
            }
<span class="fc" id="L157">          }</span>
<span class="pc bpc" id="L158" title="1 of 2 branches missed.">          return isDouble</span>
<span class="nc" id="L159">              ? (Gui4jAccessImpl) new Gui4jAccessDouble(parseCtx, accessPath)</span>
<span class="fc" id="L160">              : (Gui4jAccessImpl) new Gui4jAccessInteger(parseCtx, accessPath);</span>
        }
      case '%':
<span class="nc" id="L163">        return new Gui4jAccessCharacter(parseCtx, accessPath);</span>
      case '$':
<span class="nc" id="L165">        parseCtx.i = parseCtx.i + 1;</span>
<span class="nc" id="L166">        return parseCtx.getBaseAccess();</span>
      case '?':
<span class="nc" id="L168">        return new Gui4jAccessSetValue(parseCtx, accessPath);</span>
      default:
<span class="fc" id="L170">        return new Gui4jAccessMethod(parseCtx, thisAccess, accessPath);</span>
    }
  }

  Gui4jAccessImpl parseCallSequence(ParseCtx parseCtx, String accessPath) {
<span class="fc" id="L175">    Gui4jAccessImpl gui4jAccess = parseCtx.getBaseAccess();</span>
<span class="fc" id="L176">    int len = accessPath.length();</span>
    do {
<span class="fc" id="L178">      gui4jAccess = getInstance(parseCtx, gui4jAccess, accessPath);</span>
<span class="fc bfc" id="L179" title="All 4 branches covered.">      if (parseCtx.i &lt; len &amp;&amp; accessPath.charAt(parseCtx.i) == '.') {</span>
<span class="fc" id="L180">        parseCtx.i = parseCtx.i + 1;</span>
      } else {
<span class="fc" id="L182">        return gui4jAccess;</span>
      }
    } while (true);
  }

  static void skipSpaces(ParseCtx parseCtx, int len) {
<span class="pc bpc" id="L188" title="1 of 4 branches missed.">    while (parseCtx.i &lt; len &amp;&amp; parseCtx.mAccessPath.charAt(parseCtx.i) == ' ') {</span>
<span class="nc" id="L189">      parseCtx.i++;</span>
    }
<span class="fc" id="L191">  }</span>

  private Gui4jAccessImpl createSeq(Gui4jAccessImpl first, Gui4jAccessImpl second) {
<span class="fc bfc" id="L194" title="All 2 branches covered.">    if (first == null) {</span>
<span class="fc" id="L195">      return second;</span>
    }
<span class="fc" id="L197">    return new Gui4jAccessSeq(first, second);</span>
  }

  private Gui4jAccessImpl parseSeqSequence(ParseCtx parseCtx, String accessPath) {
<span class="fc" id="L201">    Gui4jAccessImpl gui4jAccess = null;</span>
<span class="fc" id="L202">    int len = accessPath.length();</span>
    do {
<span class="fc" id="L204">      gui4jAccess = createSeq(gui4jAccess, parseCallSequence(parseCtx, accessPath));</span>
<span class="fc" id="L205">      skipSpaces(parseCtx, len);</span>
<span class="pc bpc" id="L206" title="1 of 4 branches missed.">      if (parseCtx.i &lt; len &amp;&amp; accessPath.charAt(parseCtx.i) == ';') {</span>
<span class="fc" id="L207">        parseCtx.i = parseCtx.i + 1;</span>
      } else {
<span class="fc" id="L209">        return gui4jAccess;</span>
      }
    } while (true);
  }

  private List parseDependantProperties(ParseCtx parseCtx, String accessPath) {
<span class="nc" id="L215">    List dependantProps = new ArrayList();</span>
<span class="nc" id="L216">    int len = accessPath.length();</span>
<span class="nc" id="L217">    parseCtx.i++; // skip '{'</span>
    loop:
    do {
<span class="nc" id="L220">      Gui4jAccessImpl property = parseCallSequence(parseCtx, accessPath);</span>
<span class="nc" id="L221">      Gui4jTypeCheck.ensureType(</span>
<span class="nc" id="L222">          property.getResultClass(), Gui4jEvent.class, parseCtx.getConfigurationName(), accessPath);</span>
<span class="nc" id="L223">      dependantProps.add(new Gui4jDefaultCall(parseCtx.getGui4jComponent(), property, null, null));</span>
<span class="nc" id="L224">      skipSpaces(parseCtx, len);</span>
<span class="nc bnc" id="L225" title="All 2 branches missed.">      if (parseCtx.i &lt; len) {</span>
<span class="nc bnc" id="L226" title="All 3 branches missed.">        switch (accessPath.charAt(parseCtx.i)) {</span>
          case '}':
<span class="nc" id="L228">            parseCtx.i++;</span>
<span class="nc" id="L229">            return dependantProps;</span>
          case ',':
<span class="nc" id="L231">            parseCtx.i++;</span>
<span class="nc" id="L232">            break;</span>
          default:
<span class="nc" id="L234">            Object[] args = {accessPath, Integer.valueOf(parseCtx.i)};</span>
<span class="nc" id="L235">            throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L236">                parseCtx.getConfigurationName(),</span>
<span class="nc" id="L237">                parseCtx.getLineNumber(),</span>
                RESOURCE_ERROR_access_unexpected_character,
                args);
        }
      } else {
<span class="nc" id="L242">        Object[] args = {accessPath, Integer.valueOf(parseCtx.i)};</span>
<span class="nc" id="L243">        throw new Gui4jUncheckedException.ResourceError(</span>
<span class="nc" id="L244">            parseCtx.getConfigurationName(),</span>
<span class="nc" id="L245">            parseCtx.getLineNumber(),</span>
            RESOURCE_ERROR_access_unexpected_end,
            args);
      }
<span class="nc" id="L249">    } while (true);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>